# Plan Técnico: Botón "ANOTAR PREGUNTA"

## Descripción de la funcionalidad

Se requiere implementar un botón "ANOTAR PREGUNTA" en la zona inferior del juego (footer) para todos los usuarios logeados que estén en el turno de juego (no en el de movimiento). Este botón permitirá a los usuarios anotar cuántas preguntas está realizando cada uno, mostrando visualmente el conteo mediante palos "I" (i mayúscula) debajo del emoji del avatar en `player-status-cell`.

## Archivos y funciones que deben cambiarse

### 1. Archivo: `web/index.html`

#### Cambios en la estructura HTML:
- **Línea ~1208**: Agregar botón "ANOTAR PREGUNTA" en el footer junto al botón "TERMINAR RONDA"
- **Línea ~2710**: Modificar la generación de `player-status-cell` para incluir el contador de preguntas

#### Cambios en JavaScript:
- **Función `generateAndSaveDistribution` (línea ~1592)**: Agregar inicialización del diccionario de preguntas
- **Función `restartGame` (línea ~2919)**: Resetear el diccionario de preguntas a cero
- **Función `updateGameUI`**: Agregar lógica para mostrar contadores de preguntas
- **Nueva función**: `addQuestion()` para manejar el clic del botón
- **Nueva función**: `updateQuestionCounters()` para actualizar la UI con los contadores

### 2. Archivo: `web/firebase-modular.js`

#### Cambios en funciones existentes:
- **Función `savePlayerDistribution` (línea ~50)**: Agregar campo `numberQuestionsMade` al documento del juego
- **Función `resetDeadsArray` (línea ~187)**: Agregar reset del diccionario de preguntas

#### Nueva función:
- **Función `updateQuestionCount`**: Para actualizar el contador de preguntas de un jugador específico

## Algoritmo paso a paso

### 1. Estructura de datos en Firebase
```javascript
{
  // ... otros campos existentes
  numberQuestionsMade: {
    1: 0,  // Jugador 1: 0 preguntas
    2: 0,  // Jugador 2: 0 preguntas
    3: 0,  // Jugador 3: 0 preguntas
    // ... hasta totalPlayers
  }
}
```

### 2. Flujo de anotación de pregunta
1. Usuario hace clic en "ANOTAR PREGUNTA"
2. Se obtiene el número de jugador actual desde `window.gameParams.playerNumber`
3. Se incrementa el contador en Firebase para ese jugador
4. Se actualiza la UI local para mostrar el nuevo contador
5. Se sincroniza con otros jugadores en tiempo real

### 3. Visualización de contadores
1. Para cada jugador en `player-status-cell`:
   - Obtener el número de preguntas desde `numberQuestionsMade[playerNumber]`
   - Generar string de "I" repetidas según el contador
   - Insertar debajo del emoji del avatar

### 4. Reset al reiniciar juego
1. Al ejecutar `restartGame()`:
   - Crear diccionario con todos los valores a 0
   - Actualizar Firebase con el nuevo estado
   - Limpiar contadores en la UI

## Fases de implementación

### Fase 1: Capa de datos
- Modificar `savePlayerDistribution` para incluir `numberQuestionsMade`
- Crear función `updateQuestionCount` en Firebase modular
- Modificar `resetDeadsArray` para resetear contadores

### Fase 2A: Interfaz de usuario
- Agregar botón "ANOTAR PREGUNTA" en el footer
- Modificar generación de `player-status-cell` para mostrar contadores
- Implementar función `addQuestion()` para manejar clics

### Fase 2B: Lógica de negocio
- Implementar función `updateQuestionCounters()` para sincronización
- Integrar con sistema de actualizaciones en tiempo real
- Manejar casos edge (jugadores muertos, reinicio de juego)

## Detalles específicos del prompt del usuario

- **Ubicación del botón**: Zona inferior (footer), a la derecha del botón "TERMINAR RONDA"
- **Visibilidad**: Solo para usuarios logeados en turno de juego (no en movimiento)
- **Representación visual**: Palos "I" (i mayúscula) debajo del emoji del avatar
- **Sin límite**: No hay límite en el número de preguntas que se pueden anotar
- **Campo en Firebase**: Nuevo campo `numberQuestionsMade` de tipo diccionario
- **Reset automático**: Al reiniciar el juego, todos los contadores vuelven a 0
- **Sincronización**: Los contadores se muestran en tiempo real para todos los jugadores
