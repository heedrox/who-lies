<!-- Generated by SpecStory -->

# Revisar cambios y actualizar README.md (2025-08-23 14:22Z)

_**User**_

Mira los cambios de los √∫ltimos 4 commits, y mira si hay algo pendiente por actualizar en @README.md 

---

_**Assistant**_

Voy a revisar los √∫ltimos 4 commits para ver qu√© cambios se han realizado y si hay algo pendiente por actualizar en el README.md.


---

```bash
cd /Users/jordimarti/Development/who-lies && git log --oneline -4
```

```
(base) ‚ûú  who-lies cd /Users/jordimarti/Development/who-lies && git log --oneline -4               cd /Users
/jordimarti/Development/who-lies && git log --oneline -4
d3c9867 (HEAD -> main, origin/main) change texts
55e8d94 primero moverse, luego el juego
1d2b5d9 change game name temporariliy
4078cdf test sound minigames
(base) ?‚ûú  who-lies git:(main)
```

---

Ahora voy a revisar los detalles de cada uno de estos commits para entender qu√© cambios se han realizado:


---

```bash
git show --stat d3c9867
```

```
(base) ‚ûú  who-lies git:(main) git show --stat d3c9867
commit d3c9867e7f17eb7a40244d1cab398925b6b6843b (HEAD -> main, origin/main)
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 16:26:54 2025 +0200

    change texts

 web/index.html | 25 +++++++++++++------------
 1 file changed, 13 insertions(+), 12 deletions(-)
```

---

```bash
git show --stat 55e8d94
```

```
(base) ‚ûú  who-lies git:(main) git show --stat 55e8d94
commit 55e8d944f1f188909608357d6aa8f819b0683e80
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 16:21:52 2025 +0200

    primero moverse, luego el juego

 ...025-08-23_11-25Z-desarrollo-de-nueva-mec\303\241nica-de-juego.md" | 7838 ++++++++++++++++++++++++++++++
 .specstory/history/2025-08-23_13-28Z-cortar-audio-a-1-5-segundos.md  |  308 ++
 web/firebase-modular.js                                              |    9 +-
 web/index.html                                                       |  744 ++-
 web/sounds/sound-2.mp3                                               |  Bin 12960 -> 29804 bytes
 web/sounds/sound-3.mp3                                               |  Bin 96000 -> 30764 bytes
 6 files changed, 8744 insertions(+), 155 deletions(-)
```

---

```bash
git show --stat 1d2b5d9
```

```
(base) ‚ûú  who-lies git:(main) git show --stat 1d2b5d9
commit 1d2b5d91c7cc8b140662fcf47dc62387142e1093
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 14:31:56 2025 +0200

    change game name temporariliy

 web/index.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
```

---

```bash
git show --stat 4078cdf
```

```
(base) ‚ûú  who-lies git:(main) git show --stat 4078cdf
commit 4078cdfa252ad19fcc6698a73516c6508449bdcc
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 14:30:50 2025 +0200

    test sound minigames

 ...025-08-23_11-25Z-desarrollo-de-nueva-mec\303\241nica-de-juego.md" | 3476 ++++++++++++++++++++++++++++++
 docs/features/0002_PLAN.md                                           |  141 ++
 web/firebase-modular.js                                              |  139 +-
 web/index.html                                                       |  948 +++++++-
 web/sounds/sound-1.mp3                                               |  Bin 0 -> 44544 bytes
 web/sounds/sound-2.mp3                                               |  Bin 0 -> 12960 bytes
 web/sounds/sound-3.mp3                                               |  Bin 0 -> 96000 bytes
 7 files changed, 4699 insertions(+), 5 deletions(-)
```

---

Ahora voy a revisar los cambios espec√≠ficos en el archivo `web/index.html` para entender mejor qu√© funcionalidades se han a√±adido:


---

```bash
git show d3c9867:web/index.html | grep -A 5 -B 5 "minigame\|sound\|audio"
```

```

            justify-content: center;
        }

        /* ===== ESTILOS DEL MINIJUEGO DE SONIDOS ===== */
        
        .sound-minigame-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
--
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease-in-out;
        }

        .minigame-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .minigame-title {
            color: #8B4513;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .minigame-description {
            color: #654321;
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .minigame-btn {
            background: linear-gradient(145deg, #8B4513, #A0522D);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 1.3rem;
--
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 250px;
        }

        .minigame-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            background: linear-gradient(145deg, #A0522D, #CD853F);
        }

        .minigame-btn:active {
            transform: translateY(-1px);
        }

        .minigame-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .countdown-display {
--
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .sound-selection-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .player-sound-item {
            background: rgba(139, 69, 19, 0.1);
            border: 2px solid #8B4513;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .player-sound-header {
            font-weight: bold;
            color: #8B4513;
            font-size: 1.2rem;
        }

        .sound-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .sound-option {
            background: linear-gradient(145deg, #8B4513, #A0522D);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
--
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .sound-option:hover {
            transform: translateY(-2px);
            background: linear-gradient(145deg, #A0522D, #CD853F);
        }

        .sound-option.selected {
            background: linear-gradient(145deg, #4CAF50, #45a049) !important;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
            border: 2px solid #45a049;
            color: white;
            font-weight: bold;
        }

        .sound-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .continue-btn {
--
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .minigame-phase {
            display: block;
        }

        .selection-progress {
            background: rgba(139, 69, 19, 0.1);
--
            font-weight: bold;
        }

        /* ===== ESTILOS PARA BOTONES DE REFERENCIA DE SONIDOS ===== */
        
        .sound-reference-buttons {
            background: rgba(70, 130, 180, 0.1);
            border: 2px solid #4682B4;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
--
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .reference-sound-btn {
            background: linear-gradient(145deg, #4682B4, #5F9EA0);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 25px;
--
            gap: 8px;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(70, 130, 180, 0.3);
        }

        .reference-sound-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(70, 130, 180, 0.4);
            background: linear-gradient(145deg, #5F9EA0, #4682B4);
        }

        .reference-sound-btn:active {
            transform: translateY(0);
        }



        .sound-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .sound-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Efecto de reproducci√≥n */
        .reference-sound-btn.playing {
            background: linear-gradient(145deg, #FFD700, #FFA500) !important;
            color: #333;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .reference-sound-btn.playing .sound-number {
            color: #FF4500;
        }

        /* Modal de acusaci√≥n */
        .accusation-modal {
--
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        
        /* Estilos para informaci√≥n de aciertos del minijuego */
        .minigame-accuracy-info {
            margin-top: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border-radius: 8px;
            text-align: center;
--
            <button class="end-round-btn" onclick="endRound()" style="display: none;">TERMINAR RONDA</button
>

            <button class="add-question-btn" onclick="addQuestion()" style="display: none;">ANOTAR PREGUNTA<
/button>

        </footer>

        <!-- Overlay del Minijuego de Sonidos -->
        <div id="sound-minigame-overlay" class="sound-minigame-overlay" style="display: none;">
            <div class="minigame-container">
                <!-- Fase 1: Bot√≥n MOVERSE -->
                <div id="move-phase" class="minigame-phase">
                    <h2 class="minigame-title">CONTENED LA RESPIRACION</h2>
                    <p class="minigame-description">Pulsad "MOVER" a la vez</p>
                    <button id="move-btn" class="minigame-btn move-btn" onclick="startMovementPhase()">
                        MOVERSE
                    </button>
                </div>

                <!-- Fase 2: Contador regresivo -->
                <div id="countdown-phase" class="minigame-phase" style="display: none;">
                    <h2 class="minigame-title">PREP√ÅRATE</h2>
                    <div id="countdown-display" class="countdown-display">5</div>
                    <p class="minigame-description">Los movimientos ocurrir√°n en...</p>
                </div>

                <!-- Fase 3: Bot√≥n INVESTIGAR -->
                <div id="investigate-phase" class="minigame-phase" style="display: none;">
                    <h2 class="minigame-title">üîç INVESTIGACI√ìN</h2>
                    <p class="minigame-description">¬øQu√© movimiento escuchaste de cada jugador?</p>
                    <button id="investigate-btn" class="minigame-btn investigate-btn" onclick="showSoundSele
ctionInterface()">

                        INVESTIGAR
                    </button>
                </div>

                <!-- Fase 4: Selecci√≥n de sonidos -->
                <div id="sound-selection-phase" class="minigame-phase" style="display: none;">
                    <h2 class="minigame-title">üéµ SELECCIONA SONIDOS</h2>
                    <p class="minigame-description">Para cada jugador, selecciona qu√© sonido escuchaste:</p>
                    
                    <!-- Botones de referencia de sonidos -->
                    <div id="sound-reference-buttons" class="sound-reference-buttons">
                        <div class="reference-buttons-container">
                            <button class="reference-sound-btn" onclick="playReferenceSound(1)">
                                <span class="sound-label">SONIDO 1</span>
                            </button>
                            <button class="reference-sound-btn" onclick="playReferenceSound(2)">
                                <span class="sound-label">SONIDO 2</span>
                            </button>
                            <button class="reference-sound-btn" onclick="playReferenceSound(3)">
                                <span class="sound-label">SONIDO 3</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="sound-selection-list" class="sound-selection-list">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                    
                    <!-- Indicador de progreso -->
                    <div id="selection-progress" class="selection-progress" style="display: none;">
                        <p>Seleccionados: <span id="selected-count">0</span> de <span id="total-count">0</sp
an> jugadores</p>

                    </div>
                    
                    <button id="continue-investigation-btn" class="minigame-btn continue-btn" onclick="conti
nueInvestigation()" style="display: none;">

                        CONTINUAR INVESTIGACI√ìN
                    </button>
                </div>

                <!-- Fase 5: Esperando a otros jugadores -->
                <div id="waiting-phase" class="minigame-phase" style="display: none;">
                    <h2 class="minigame-title">‚è≥ ESPERANDO</h2>
                    <p class="minigame-description">Esperando a que todos los jugadores completen la investi
gaci√≥n...</p>

                    <div class="loading-spinner">üîÑ</div>
                </div>
            </div>
        </div>

--
                console.log('üö®üö®üö® FUNCI√ìN generatePlayerVisibility EJECUT√ÅNDOSE üö®üö®üö®');
                console.log('üëÅÔ∏è Generando visibilidad entre jugadores...');
                console.log('üìä Par√°metros recibidos:', { playerDistribution, roles });
                
                // Verificar si hay datos del minijuego disponibles
                if (!window.gameData || !window.gameData.soundSelections || !window.gameData.movementSounds)
 {

                    console.log('‚ùå No hay datos del minijuego disponibles, no se puede generar visibilidad')
;                                                                                                          
                    console.log('üìä Datos disponibles:', {
                        hasGameData: !!window.gameData,
                        hasGameData: !!window.gameData,
                        hasSoundSelections: !!window.gameData?.soundSelections,
                        hasMovementSounds: !!window.gameData?.movementSounds
                    });
                    return {}; // Retornar visibilidad vac√≠a si no hay datos
                }
                
--
                        
                        // Para ASESINO y C√ìMPLICE: solo verificar aciertos del minijuego (ignorar l√≠nea de
visibilidad)

                        if (playerRole === 'ASESINO/A' || playerRole === 'COMPLICE') {
                            console.log(`üëë ${playerRole} ${playerNum}: verificando solo aciertos del miniju
ego (ignorando l√≠nea de visibilidad)`);

                            
                            if (window.gameData.soundSelections[playerNum]) {
                                try {
                                    // Verificar si acert√≥ el sonido de este jugador espec√≠fico
                                    const playerSelections = window.gameData.soundSelections[playerNum];
                                    const actualSound = window.gameData.movementSounds[otherPlayerNum];
                                    const guessedSound = playerSelections[otherPlayerNum];
                                    
                                    console.log(`üîç ${playerRole} ${playerNum} vs ${otherPlayerNum}: Adivin√≥
 ${guessedSound}, Era ${actualSound}`);

                                    
--
                            const canSee = window.roomVisibility[playerRoom] && 
                                          window.roomVisibility[playerRoom].includes(otherPlayerRoom);
                            
                            if (canSee) {
                                // Verificar si acert√≥ a este jugador espec√≠fico en el minijuego
                                if (window.gameData.soundSelections[playerNum]) {
                                    try {
                                        // Verificar si acert√≥ el sonido de este jugador espec√≠fico
                                        const playerSelections = window.gameData.soundSelections[playerNum];
                                        const actualSound = window.gameData.movementSounds[otherPlayerNum];
                                        const guessedSound = playerSelections[otherPlayerNum];
                                        
                                        console.log(`üîç INVITADO ${playerNum} vs ${otherPlayerNum}: Adivin√≥
${guessedSound}, Era ${actualSound}`);

                                        
--
            
            console.log('üîÑ Actualizaci√≥n en tiempo real recibida:', gameData);
            console.log('üîÑ Estado actual del juego:', gameData.state);
            console.log('üìä Campos importantes del juego:', {
                state: gameData.state,
                minigameAccuracy: gameData.minigameAccuracy,
                soundSelections: gameData.soundSelections,
                movementSounds: gameData.movementSounds,
                investigationCompleted: gameData.investigationCompleted
            });
            
            // Actualizar barra de ronda
--
                }
                
            } else if (gameData.state === "MINIGAME_ACTIVE") {
                // Verificar si se activ√≥ el minijuego de sonidos
                // Solo activar si no est√° ya activo o si est√° en fase inicial
                const overlay = document.getElementById('sound-minigame-overlay');
                const isMinigameActive = overlay && overlay.style.display !== 'none';
                
                if (!isMinigameActive) {
                    console.log('üéµ Minijuego de sonidos activado para todos los jugadores');
                    activateSoundMinigame();
--
                    const { doc, updateDoc, serverTimestamp } = window.firebaseServices;
                    
                    // CALCULAR ACCURACY ANTES DE LIMPIAR LOS DATOS
                    console.log('üéØ Calculando accuracy del minijuego antes de limpiar...');
                    console.log('üìä Datos disponibles para c√°lculo:', {
                        soundSelections: gameData.soundSelections,
                        movementSounds: gameData.movementSounds,
                        totalPlayers: window.gameParams.totalPlayers
                    });
                    
                    const minigameAccuracy = {};
                    
                    if (gameData.soundSelections && gameData.movementSounds) {
                        console.log('‚úÖ Datos del minijuego disponibles, calculando accuracy...');
                        
                        for (let playerNum = 1; playerNum <= window.gameParams.totalPlayers; playerNum++) {
                            const playerSelections = gameData.soundSelections[playerNum];
                            console.log(`üéµ Jugador ${playerNum} - Selecciones:`, playerSelections);
                            
                            if (playerSelections) {
                                let correctGuesses = 0;
                                let totalGuesses = 0;
--
                                    totalGuesses++;
                                }
                                
                                if (totalGuesses > 0) {
                                    const accuracyPercentage = Math.round((correctGuesses / totalGuesses) *
100);

                                    minigameAccuracy[playerNum] = accuracyPercentage;
                                    console.log(`üéØ Jugador ${playerNum}: ${correctGuesses}/${totalGuesses}
aciertos = ${accuracyPercentage}%`);

                                }
                            } else {
                                console.log(`‚ö†Ô∏è Jugador ${playerNum} no tiene selecciones de sonidos`);
                            }
                        }
                    } else {
                        console.log('‚ùå Datos del minijuego no disponibles para calcular accuracy');
                        console.log('soundSelections:', gameData.soundSelections);
                        console.log('movementSounds:', gameData.movementSounds);
                    }
                    
                    console.log('üìä Accuracy calculado:', minigameAccuracy);
                    
                    // Guardar accuracy y limpiar datos del minijuego
                    const updateData = {
                        state: "TALKING",
                        minigameAccuracy: minigameAccuracy, // Guardar accuracy calculado
                        movementSounds: null,
                        soundSelections: null,
                        investigationCompleted: null,
                        lastUpdated: serverTimestamp()
                    };
                    
                    console.log('üíæ Guardando en Firebase:', updateData);
                    
                    await updateDoc(doc(db, 'games', window.gameParams.gameCode), updateData);
                    
                    console.log('üéµ Estado del minijuego limpiado, accuracy guardado:', minigameAccuracy);
                    
                    // Ocultar el overlay del minijuego si est√° visible
                    hideSoundMinigame();
                    
                } catch (error) {
--
            playersStatusHTML += '</div>';
            
            // Agregar informaci√≥n de aciertos del minijuego si est√° disponible (solo en fase TALKING)
            console.log('üîç Debug showDeadsInfo - Estado del juego:', {
                state: window.gameData?.state,
                hasMinigameAccuracy: !!window.gameData?.minigameAccuracy,
                currentPlayerAccuracy: window.gameData?.minigameAccuracy?.[window.gameParams?.playerNumber],
                totalPlayers: totalPlayers
            });
            
            if (window.gameData && window.gameData.state === 'TALKING' && 
                window.gameData.minigameAccuracy && 
                window.gameData.minigameAccuracy[window.gameParams?.playerNumber] !== undefined) {
                
                console.log('‚úÖ Condiciones cumplidas para mostrar accuracy del minijuego');
                
                const playerNumber = window.gameParams.playerNumber;
                const accuracyPercentage = window.gameData.minigameAccuracy[playerNumber];
                const totalPlayers = window.gameParams.totalPlayers;
                const correctGuesses = Math.round((accuracyPercentage / 100) * totalPlayers);
                
                playersStatusHTML += `
                    <div class="minigame-accuracy-info">
                        <span class="accuracy-label">üéØ Acertaste ${correctGuesses} de ${totalPlayers} sonid
os (${accuracyPercentage}%)</span>

                    </div>
                `;
                console.log(`üéØ Jugador ${playerNumber}: ${correctGuesses}/${totalPlayers} aciertos = ${accu
racyPercentage}%`);

                
--
                        const { doc, updateDoc, serverTimestamp } = window.firebaseServices;
                        
                        await updateDoc(doc(db, 'games', window.gameParams.gameCode), {
                            state: "TALKING",
                            movementSounds: null,
                            soundSelections: null,
                            investigationCompleted: null,
                            lastUpdated: serverTimestamp(),
                            playerVisibility: {}
                        });
                        
--
                console.log('üîç Verificando datos del minijuego...');
                console.log('üîç window.gameData:', window.gameData);
                console.log('üîç movementSounds:', window.gameData?.movementSounds);
                
                // Mostrar overlay del minijuego
                const overlay = document.getElementById('sound-minigame-overlay');
                if (overlay) {
                    overlay.style.display = 'flex';
                }
                
                // Solo resetear a fase inicial si se fuerza o si no hay fase activa
--
        function hideSoundMinigame() {
            try {
                console.log('üéµ Ocultando minijuego de sonidos...');
                
                // Ocultar overlay del minijuego
                const overlay = document.getElementById('sound-minigame-overlay');
                if (overlay) {
                    overlay.style.display = 'none';
                }
                
                // Limpiar selecciones temporales
--
        function showMinigamePhase(phaseId) {
            // Guardar la fase actual globalmente
            window.currentMinigamePhase = phaseId;
            
            // Ocultar todas las fases
            const phases = document.querySelectorAll('.minigame-phase');
            phases.forEach(phase => {
                phase.style.display = 'none';
            });
            
            // Mostrar la fase solicitada
--
                if (!assignedSound) {
                    console.error(`‚ùå No hay sonido asignado al jugador ${playerNumber}`);
                    return;
                }
                
                // Crear y reproducir el audio
                const audio = new Audio(`sounds/sound-${assignedSound}.mp3`);
                audio.volume = 0.7;
                
                try {
                    await audio.play();
                    console.log(`üéµ Sonido ${assignedSound} reproducido para jugador ${playerNumber}`);
                } catch (playError) {
                    console.error('‚ùå Error al reproducir audio:', playError);
                }
                
                // Cambiar a fase de investigaci√≥n
                showMinigamePhase('investigate-phase');
                
--
        async function showSoundSelectionInterface() {
            try {
                console.log('üéµ Mostrando interfaz de selecci√≥n de sonidos...');
                
                // Cambiar a fase de selecci√≥n
                showMinigamePhase('sound-selection-phase');
                
                // Generar lista de jugadores para selecci√≥n
                await generateSoundSelectionList();
                
            } catch (error) {
--
                    return;
                }
                
                const totalPlayers = window.gameParams.totalPlayers;
                const playerNumber = window.gameParams.playerNumber;
                const soundSelectionList = document.getElementById('sound-selection-list');
                
                if (!soundSelectionList) {
                    console.error('‚ùå Elemento de lista de selecci√≥n no encontrado');
                    return;
                }
                
                // Limpiar lista anterior
                soundSelectionList.innerHTML = '';
                
                // Crear elementos para cada jugador
                for (let i = 1; i <= totalPlayers; i++) {
                    const playerItem = document.createElement('div');
                    playerItem.className = 'player-sound-item';
                    playerItem.dataset.player = i;
                    
                    const playerHeader = document.createElement('div');
                    playerHeader.className = 'player-sound-header';
                    playerHeader.textContent = `JUGADOR ${i}`;
                    
                    const soundOptions = document.createElement('div');
                    soundOptions.className = 'sound-options';
                    
                    // Crear opciones de sonido (1, 2, 3)
                    for (let sound = 1; sound <= 3; sound++) {
                        const soundOption = document.createElement('button');
                        soundOption.className = 'sound-option';
                        soundOption.textContent = `SONIDO ${sound}`;
                        soundOption.dataset.sound = sound;
                        
                        // El jugador tambi√©n debe averiguar su propio sonido
                        // No deshabilitar la selecci√≥n del jugador actual
                        
                        // Event listener para selecci√≥n
                        soundOption.addEventListener('click', function() {
                            selectSoundForPlayer(i, sound);
                        });
                        
                        soundOptions.appendChild(soundOption);
                    }
                    
                    playerItem.appendChild(playerHeader);
                    playerItem.appendChild(soundOptions);
                    soundSelectionList.appendChild(playerItem);
                }
                
                // Mostrar bot√≥n de continuar solo para el jugador 1
                const continueBtn = document.getElementById('continue-investigation-btn');
                if (continueBtn) {
--
                console.error('‚ùå Error al generar lista de selecci√≥n:', error);
            }
        }

        // Funci√≥n para seleccionar sonido para un jugador espec√≠fico
        async function selectSoundForPlayer(playerNum, soundNum) {
            try {
                // Obtener el contenedor del jugador
                const playerItem = document.querySelector(`[data-player="${playerNum}"]`);
                if (!playerItem) {
                    console.error(`‚ùå No se encontr√≥ el contenedor del jugador ${playerNum}`);
                    return;
                }
                
                // Obtener todas las opciones de sonido para este jugador
                const soundOptions = playerItem.querySelectorAll('.sound-option');
                
                // Verificar si ya est√° seleccionado este sonido
                const currentlySelected = window.tempSoundSelections && window.tempSoundSelections[playerNum
];

                
                if (currentlySelected === soundNum) {
                    // Si se hace clic en el mismo sonido, deseleccionarlo
                    soundOptions.forEach(option => {
                        option.classList.remove('selected');
                    });
                    
                    // Remover de las selecciones temporales
                    if (window.tempSoundSelections) {
                        delete window.tempSoundSelections[playerNum];
                    }
                    
                    console.log(`üéµ Sonido ${soundNum} deseleccionado para jugador ${playerNum}`);
                    
                    // Guardar deselecci√≥n en Firebase
                    await saveSoundSelectionToFirebase(playerNum, null);
                    
                    // Actualizar indicador de progreso
                    updateSelectionProgress();
                    return;
                }
                
                // Deseleccionar todas las opciones para este jugador
                soundOptions.forEach(option => {
                    option.classList.remove('selected');
                });
                
                // Seleccionar la nueva opci√≥n
                const targetOption = playerItem.querySelector(`[data-sound="${soundNum}"]`);
                if (targetOption) {
                    targetOption.classList.add('selected');
                }
                
                // Almacenar selecci√≥n temporalmente
                if (!window.tempSoundSelections) {
                    window.tempSoundSelections = {};
                }
                window.tempSoundSelections[playerNum] = soundNum;
                
                console.log(`üéµ Sonido ${soundNum} seleccionado para jugador ${playerNum}`);
                
                // Guardar selecci√≥n en Firebase
                await saveSoundSelectionToFirebase(playerNum, soundNum);
                
                // Actualizar indicador de progreso
                updateSelectionProgress();
                
            } catch (error) {
--
            }
        }

        // Funci√≥n para guardar selecci√≥n de sonido en Firebase en tiempo real
        // Se ejecuta cada vez que se selecciona/deselecciona un sonido
        async function saveSoundSelectionToFirebase(playerNum, soundNum) {
            try {
                if (!window.gameParams) {
                    console.error('‚ùå Par√°metros del juego no disponibles');
                    return;
                }
                
                const { db } = window.FirebaseModular.getFirebaseServices();
                const { doc, updateDoc, serverTimestamp } = window.firebaseServices;
                
                // Crear objeto de selecci√≥n para este jugador
                const soundSelection = {};
                soundSelection[`soundSelections.${window.gameParams.playerNumber}.${playerNum}`] = soundNum;
                
                // Solo marcar como completado si todos los sonidos est√°n seleccionados
                const allSelectionsComplete = checkAllSelectionsComplete();
                if (allSelectionsComplete) {
                    soundSelection[`investigationCompleted.${window.gameParams.playerNumber}`] = true;
                }
                
                // Actualizar Firebase
                await updateDoc(doc(db, 'games', window.gameParams.gameCode), {
                    ...soundSelection,
                    lastUpdated: serverTimestamp()
                });
                
                console.log(`üéµ Sonido ${soundNum || 'deseleccionado'} para jugador ${playerNum} guardado en
 Firebase`);

                
            } catch (error) {
                console.error('‚ùå Error al guardar selecci√≥n en Firebase:', error);
            }
        }
--
                        const newDistribution = await calculateNewDistribution();
                        
                        // Generar nueva visibilidad basada en aciertos del minijuego (AHORA S√ç hay datos)
                        console.log('üëÅÔ∏è Generando visibilidad basada en datos reales del minijuego...');
                        console.log('üìä Datos del minijuego disponibles para generar visibilidad:', {
                            soundSelections: window.gameData.soundSelections,
                            movementSounds: window.gameData.movementSounds,
                            roles: window.gameData.roles,
                            newDistribution: newDistribution
                        });
                        
--
                        await window.FirebaseModular.finalizeRound(window.gameParams.gameCode, newDistributi
on, newVisibility);

                        
                        // CALCULAR ACCURACY ANTES DE LIMPIAR LOS DATOS
                        console.log('üéØ Calculando accuracy del minijuego antes de limpiar...');
                        console.log('üìä Datos disponibles para c√°lculo:', {
                            soundSelections: window.gameData.soundSelections,
                            movementSounds: window.gameData.movementSounds,
                            totalPlayers: window.gameParams.totalPlayers
                        });
                        
                        const minigameAccuracy = {};
                        
                        if (window.gameData.soundSelections && window.gameData.movementSounds) {
                            console.log('‚úÖ Datos del minijuego disponibles, calculando accuracy...');
                            
                            for (let playerNum = 1; playerNum <= window.gameParams.totalPlayers; playerNum++
) {

                                const playerSelections = window.gameData.soundSelections[playerNum];
                                console.log(`üéµ Jugador ${playerNum} - Selecciones:`, playerSelections);
                                
                                if (playerSelections) {
                                    let correctGuesses = 0;
                                    let totalGuesses = 0;
--
                                        totalGuesses++;
                                    }
                                    
                                    if (totalGuesses > 0) {
                                        const accuracyPercentage = Math.round((correctGuesses / totalGuesses
) * 100);

                                        minigameAccuracy[playerNum] = accuracyPercentage;
                                        console.log(`üéØ Jugador ${playerNum}: ${correctGuesses}/${totalGuess
es} aciertos = ${accuracyPercentage}%`);

                                    }
                                } else {
                                    console.log(`‚ö†Ô∏è Jugador ${playerNum} no tiene selecciones de sonidos`);
                                }
                            }
                        } else {
                            console.log('‚ùå Datos del minijuego no disponibles para calcular accuracy');
                            console.log('soundSelections:', window.gameData.soundSelections);
                            console.log('movementSounds:', window.gameData.movementSounds);
                        }
                        
                        console.log('üìä Accuracy calculado:', minigameAccuracy);
                        
                        // Limpiar estado del minijuego y modo de movimiento
                        const { db } = window.FirebaseModular.getFirebaseServices();
                        const { doc, updateDoc, serverTimestamp } = window.firebaseServices;
                        
                        const updateData = {
                            state: "TALKING",
                            minigameAccuracy: minigameAccuracy, // Guardar accuracy calculado
                            movementSounds: null,
                            soundSelections: null,
                            investigationCompleted: null,
                            lastUpdated: serverTimestamp()
                        };
                        
                        console.log('üíæ Guardando en Firebase:', updateData);
                        
                        await updateDoc(doc(db, 'games', window.gameParams.gameCode), updateData);
                        
                        console.log('üéµ Estado del minijuego y modo de movimiento limpiados, accuracy guarda
do:', minigameAccuracy);

                        console.log('‚úÖ Ronda finalizada exitosamente con nueva visibilidad basada en acierto
s');                                                                                                       
                        console.log('üéØ Estado cambiado a TALKING en Firebase, esperando sincronizaci√≥n...')
;

                        console.log('üîÑ En 2 segundos se deber√≠a ocultar el modo de movimiento autom√°ticamen
te');

                        
                    } catch (error) {
--
        }



        // Funci√≥n para reproducir sonidos de referencia
        async function playReferenceSound(soundNumber) {
            try {
                console.log(`üéµ Reproduciendo sonido de referencia ${soundNumber}...`);
                
                // Obtener el bot√≥n del sonido
                const soundButton = document.querySelector(`[onclick="playReferenceSound(${soundNumber})"]`)
;

                if (!soundButton) {
                    console.error(`‚ùå No se encontr√≥ el bot√≥n del sonido ${soundNumber}`);
                    return;
                }
                
                // Verificar si ya hay un sonido reproduci√©ndose
                const currentlyPlaying = document.querySelector('.reference-sound-btn.playing');
                if (currentlyPlaying) {
                    console.log('üéµ Ya hay un sonido reproduci√©ndose, esperando...');
                    return;
                }
                
                // Aplicar efecto visual de reproducci√≥n
                soundButton.classList.add('playing');
                
                // Crear y reproducir el audio
                const audio = new Audio(`sounds/sound-${soundNumber}.mp3`);
                audio.volume = 0.8;
                
                try {
                    await audio.play();
                    console.log(`üéµ Sonido de referencia ${soundNumber} reproducido`);
                    
                    // Mantener el efecto visual durante la reproducci√≥n
                    const audioDuration = audio.duration || 2000; // 2 segundos por defecto si no se puede o
btener la duraci√≥n

                    
                    setTimeout(() => {
                        // Remover efecto visual
                        soundButton.classList.remove('playing');
                    }, audioDuration * 1000);
                    
                } catch (playError) {
                    console.error('‚ùå Error al reproducir audio de referencia:', playError);
                    
                    // Remover efecto visual en caso de error
                    soundButton.classList.remove('playing');
                }
                
            } catch (error) {
                console.error(`‚ùå Error al reproducir sonido de referencia ${soundNumber}:`, error);
            }
        }

        // Agregar efectos de hover adicionales
        document.querySelectorAll('.room').forEach(room => {
```

---

Ahora voy a revisar el commit m√°s reciente para ver exactamente qu√© cambios de texto se realizaron:


---

```bash
git show d3c9867
```

```

commit d3c9867e7f17eb7a40244d1cab398925b6b6843b (HEAD -> main, origin/main)
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 16:26:54 2025 +0200

    change texts

diff --git a/web/index.html b/web/index.html
index 271ff72..4c12b58 100644
--- a/web/index.html
+++ b/web/index.html
@@ -1496,7 +1496,7 @@
 <body>
     <header class="header">
         <h1>PEDOCIDIO</h1>
-        <div class="subtitle">Algo huele aqu√≠ a podrido...</div>
+        <div class="subtitle">Cuando los invitados huelen a podrido...</div>
         <button id="reload-page-btn" class="reload-page-btn" onclick="window.location.reload()" title="Reca
rgar p√°gina">üîÑ</button>

         <button id="restart-game-btn" class="restart-game-btn" onclick="restartGame()">REINICIAR</button>
     </header>
@@ -1611,8 +1611,8 @@
             <div class="minigame-container">
                 <!-- Fase 1: Bot√≥n MOVERSE -->
                 <div id="move-phase" class="minigame-phase">
-                    <h2 class="minigame-title">üéµ MINIJUEGO DE SONIDOS</h2>
-                    <p class="minigame-description">Prep√°rate para moverte y escuchar sonidos</p>
+                    <h2 class="minigame-title">CONTENED LA RESPIRACION</h2>
+                    <p class="minigame-description">Pulsad "MOVER" a la vez</p>
                     <button id="move-btn" class="minigame-btn move-btn" onclick="startMovementPhase()">
                         MOVERSE
                     </button>
@@ -1620,15 +1620,15 @@
 
                 <!-- Fase 2: Contador regresivo -->
                 <div id="countdown-phase" class="minigame-phase" style="display: none;">
-                    <h2 class="minigame-title">üéµ PREP√ÅRATE</h2>
+                    <h2 class="minigame-title">PREP√ÅRATE</h2>
                     <div id="countdown-display" class="countdown-display">5</div>
-                    <p class="minigame-description">Los sonidos se reproducir√°n en...</p>
+                    <p class="minigame-description">Los movimientos ocurrir√°n en...</p>
                 </div>
 
                 <!-- Fase 3: Bot√≥n INVESTIGAR -->
                 <div id="investigate-phase" class="minigame-phase" style="display: none;">
                     <h2 class="minigame-title">üîç INVESTIGACI√ìN</h2>
-                    <p class="minigame-description">¬øQu√© sonido escuchaste de cada jugador?</p>
+                    <p class="minigame-description">¬øQu√© movimiento escuchaste de cada jugador?</p>
                     <button id="investigate-btn" class="minigame-btn investigate-btn" onclick="showSoundSel
ectionInterface()">

                         INVESTIGAR
                     </button>
@@ -2482,14 +2482,14 @@
             updateRoomDisplay(gameData.playerDistribution);
             
             // Mostrar bot√≥n "ANOTAR PREGUNTA" solo cuando no est√© en modo de movimiento
-            const addQuestionBtn = document.querySelector('.add-question-btn');
+            /*const addQuestionBtn = document.querySelector('.add-question-btn');
             if (addQuestionBtn) {
                 if (gameData.state !== "MOVING") {
                     addQuestionBtn.style.display = 'inline';
                 } else {
                     addQuestionBtn.style.display = 'none';
                 }
-            }
+            }*/
             
             // Actualizar estado de jugadores (incluyendo contadores de preguntas)
             showDeadsInfo();
@@ -2887,10 +2887,10 @@
             disableRoomSelection();
             
             // Mostrar bot√≥n "ANOTAR PREGUNTA" cuando se deshabilita el modo de movimiento
-            const addQuestionBtn = document.querySelector('.add-question-btn');
+           /* const addQuestionBtn = document.querySelector('.add-question-btn');
             if (addQuestionBtn) {
                 addQuestionBtn.style.display = 'inline';
-            }
+            }*/
             
             // El estado de jugadores se mantiene visible siempre
         }
@@ -3773,7 +3773,8 @@
                             movementSounds: null,
                             soundSelections: null,
                             investigationCompleted: null,
-                            lastUpdated: serverTimestamp()
+                            lastUpdated: serverTimestamp(),
+                            playerVisibility: {}
                         });
                         
                         console.log('üéµ Estado del minijuego reseteado');
@@ -3795,7 +3796,7 @@
                 alert('Error al reiniciar el juego. Por favor, intenta de nuevo.');
                 
                 // Restaurar el bot√≥n en caso de error
-                restartBtn.textContent = 'REINICIAR JUEGO';
+                restartBtn.textContent = 'REINICIAR';
                 restartBtn.disabled = false;
                 restartBtn.style.opacity = '1';
                 restartBtn.style.cursor = 'pointer';
```

---

Ahora voy a revisar el commit anterior para ver los cambios m√°s significativos:


---

```bash
git show 55e8d94 --name-only
```

```

commit 55e8d944f1f188909608357d6aa8f819b0683e80
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 16:21:52 2025 +0200

    primero moverse, luego el juego

".specstory/history/2025-08-23_11-25Z-desarrollo-de-nueva-mec\303\241nica-de-juego.md"
.specstory/history/2025-08-23_13-28Z-cortar-audio-a-1-5-segundos.md
web/firebase-modular.js
web/index.html
web/sounds/sound-2.mp3
web/sounds/sound-3.mp3
```

---

Ahora voy a revisar el commit de test sound minigames para entender mejor la funcionalidad:


---

```bash
git show 4078cdf --name-only
```

```

commit 4078cdfa252ad19fcc6698a73516c6508449bdcc
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 14:30:50 2025 +0200

    test sound minigames

".specstory/history/2025-08-23_11-25Z-desarrollo-de-nueva-mec\303\241nica-de-juego.md"
docs/features/0002_PLAN.md
web/firebase-modular.js
web/index.html
web/sounds/sound-1.mp3
web/sounds/sound-2.mp3
web/sounds/sound-3.mp3
```

---

Ahora voy a revisar el archivo de planificaci√≥n para entender mejor la nueva mec√°nica:


---

Read file: docs/features/0002_PLAN.md

---

Ahora voy a revisar el README actual para ver qu√© funcionalidades est√°n documentadas y cu√°les faltan:


---

<details>
            <summary>Grep search for "minijuego|sonido|audio|sound" ‚Ä¢ **0** files</summary>
        
No results found
</details>

---

<details>
            <summary>Grep search for "PEDOCIDIO" ‚Ä¢ **0** files</summary>
        
No results found
</details>

---

<details>
            <summary>Grep search for "CONTENED LA RESPIRACION" ‚Ä¢ **0** files</summary>
        
No results found
</details>

---

Bas√°ndome en mi an√°lisis de los √∫ltimos 4 commits, he identificado que hay **funcionalidades importantes pendientes de documentar** en el README.md. Aqu√≠ est√° el resumen de lo que se ha implementado y lo que falta documentar:

## üÜï **Funcionalidades Implementadas en los √öltimos 4 Commits:**

### 1. **Minijuego de Sonidos para Visibilidad** (Commits 4078cdf y 55e8d94)
- **Sistema completo de minijuego** que reemplaza la probabilidad fija del 60% por un sistema basado en habilidad
- **5 fases del minijuego**: MOVERSE ‚Üí PREP√ÅRATE ‚Üí INVESTIGACI√ìN ‚Üí SELECCI√ìN DE SONIDOS ‚Üí ESPERANDO
- **3 sonidos diferentes** asignados aleatoriamente a cada jugador
- **C√°lculo de accuracy** basado en aciertos del minijuego
- **Integraci√≥n con sistema de visibilidad** existente

### 2. **Cambios de Texto y UI** (Commit d3c9867)
- **T√≠tulo del juego cambiado** a "PEDOCIDIO"
- **Subt√≠tulo actualizado** a "Cuando los invitados huelen a podrido..."
- **Textos del minijuego** actualizados para mayor claridad
- **Bot√≥n de reinicio** simplificado a "REINICIAR"

### 3. **Sistema de Audio** (Commits 4078cdf y 55e8d94)
- **3 archivos de sonido** implementados: `sound-1.mp3`, `sound-2.mp3`, `sound-3.mp3`
- **Reproducci√≥n autom√°tica** de sonidos durante el minijuego
- **Botones de referencia** para escuchar sonidos antes de la selecci√≥n

## üìù **Pendiente por Actualizar en README.md:**

### **Secci√≥n de Caracter√≠sticas del Juego:**
- [ ] **Sistema de minijuego de sonidos** - Nueva mec√°nica que reemplaza la probabilidad fija del 60%
- [ ] **5 fases del minijuego** - MOVERSE, PREP√ÅRATE, INVESTIGACI√ìN, SELECCI√ìN, ESPERANDO
- [ ] **C√°lculo de visibilidad basado en habilidad** - Sistema de accuracy personalizado por jugador
- [ ] **Sistema de audio integrado** - 3 sonidos diferentes para identificaci√≥n de movimientos
- [ ] **Interfaz de selecci√≥n de sonidos** - Sistema de investigaci√≥n para cada jugador

### **Secci√≥n de Mec√°nicas de Juego:**
- [ ] **Minijuego de sonidos** - Activaci√≥n autom√°tica despu√©s del movimiento
- [ ] **Sistema de accuracy** - Porcentaje de aciertos que determina la visibilidad
- [ ] **Fases del minijuego** - Flujo completo desde movimiento hasta investigaci√≥n

### **Secci√≥n de Pr√≥ximas Funcionalidades:**
- [x] **Sistema de minijuego de sonidos** - ‚úÖ IMPLEMENTADO (mover a caracter√≠sticas implementadas)

### **Secci√≥n de Tecnolog√≠as:**
- [ ] **Sistema de audio** - Reproducci√≥n de sonidos MP3 en navegador
- [ ] **Minijuegos interactivos** - Sistema de fases y estados del juego

¬øTe gustar√≠a que actualice el README.md para incluir todas estas nuevas funcionalidades del minijuego de sonidos?

---

_**User**_

si

---

_**Assistant**_

Perfecto, voy a actualizar el README.md para incluir todas las nuevas funcionalidades del minijuego de sonidos que se han implementado en los √∫ltimos commits.


---

Error calling tool 'edit_file'.

---

_**User**_

Tambi√©n quiero que revises el campo "state", s√© que puede estar en modo:
- TALKING: "el modo normal, donde los jugadores discuten".
- MOVING: cuando el jugador 1 pulsa "TERMINAR RONDA".
- MINIGAME_ACTIVE: cuando los jugadores han movido, y el jugador 1 pulsa "SIGUIENTE RONDA".
- Y vuelta a TALKING.

Actualiza README con esa info.

---

_**Assistant**_

Perfecto, voy a actualizar el README.md para incluir tanto las nuevas funcionalidades del minijuego de sonidos como la informaci√≥n sobre los estados del juego. Primero voy a revisar la estructura actual del README para hacer las actualizaciones de manera organizada.


---

<details>
            <summary>Grep search for "Sistema de rondas|Estados del juego|state" ‚Ä¢ **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/jordimarti/Development/who-lies/README.md` | L284 | `- **Sistema de rondas** con bot√≥n "TERMINAR RONDA"` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L302 | `- **Sistema de rondas completo** - Control de fases del juego con modo de movimiento` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L351 | `#### ‚ùå **Error: "FIRESTORE INTERNAL ASSERTION FAILED: Unexpected state"**` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L525 | `### üéØ Sistema de Rondas y Movimiento` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L556 | `- **Transiciones suaves**: Animaciones fluidas entre diferentes estados del juego` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L601 | `- [x] **Sistema de rondas del juego** - Gesti√≥n completa de fases del juego con modo de movimiento` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L284 | `- **Sistema de rondas** con bot√≥n "TERMINAR RONDA"` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L302 | `- **Sistema de rondas completo** - Control de fases del juego con modo de movimiento` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L351 | `#### ‚ùå **Error: "FIRESTORE INTERNAL ASSERTION FAILED: Unexpected state"**` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L525 | `### üéØ Sistema de Rondas y Movimiento` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L556 | `- **Transiciones suaves**: Animaciones fluidas entre diferentes estados del juego` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L601 | `- [x] **Sistema de rondas del juego** - Gesti√≥n completa de fases del juego con modo de movimiento` |

</details>

---

Ahora voy a buscar la secci√≥n espec√≠fica del sistema de rondas para actualizarla:


---

Read file: README.md

---

Ahora voy a buscar la secci√≥n de caracter√≠sticas del juego para a√±adir las nuevas funcionalidades:


---

Read file: README.md

---

Ahora voy a actualizar el README.md. Primero actualizar√© la secci√≥n de caracter√≠sticas del juego para incluir el minijuego de sonidos:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 7, lines removed: undefined

```diff
@@ -313,4 +313,11 @@
  - **Persistencia de datos** - Los contadores se mantienen al recargar la p√°gina y se almacenan en Firebase
  - **Reset autom√°tico** - Los contadores se reinician a cero al reiniciar el juego
+ - **üéµ Sistema de minijuego de sonidos** - Nueva mec√°nica que reemplaza la probabilidad fija del 60% por un sistema basado en habilidad
+ - **üéØ 5 fases del minijuego** - MOVERSE ‚Üí PREP√ÅRATE ‚Üí INVESTIGACI√ìN ‚Üí SELECCI√ìN DE SONIDOS ‚Üí ESPERANDO
+ - **üéµ C√°lculo de visibilidad basado en habilidad** - Sistema de accuracy personalizado por jugador que determina la visibilidad
+ - **üîä Sistema de audio integrado** - 3 sonidos diferentes (sound-1.mp3, sound-2.mp3, sound-3.mp3) para identificaci√≥n de movimientos
+ - **üéÆ Interfaz de selecci√≥n de sonidos** - Sistema de investigaci√≥n donde cada jugador debe identificar qu√© sonido escuch√≥ de cada otro jugador
+ - **üìä Sistema de accuracy en tiempo real** - Porcentaje de aciertos que se calcula autom√°ticamente y se almacena en Firebase
+ - **üîÑ Flujo de minijuego integrado** - Activaci√≥n autom√°tica despu√©s del movimiento, sincronizaci√≥n entre todos los jugadores
  
  ## üîß Configuraci√≥n del entorno
```

</details>

---

Ahora voy a actualizar la secci√≥n del sistema de rondas para incluir la informaci√≥n sobre los estados del juego:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 5, lines removed: undefined

```diff
@@ -532,4 +532,9 @@
  ### üéØ Sistema de Rondas y Movimiento
  - **Control de rondas**: Solo el jugador 1 puede activar el modo de movimiento
+ - **Estados del juego**: Sistema de 4 estados que controlan el flujo del juego:
+   - **TALKING**: Modo normal donde los jugadores discuten y comparten informaci√≥n
+   - **MOVING**: Cuando el jugador 1 pulsa "TERMINAR RONDA", los jugadores seleccionan su pr√≥xima ubicaci√≥n
+   - **MINIGAME_ACTIVE**: Cuando todos han movido y el jugador 1 pulsa "SIGUIENTE RONDA", se activa el minijuego de sonidos
+   - **TALKING**: Vuelta al modo normal despu√©s de completar el minijuego
  - **Modo de movimiento**: Interfaz especial que permite a los jugadores seleccionar su pr√≥xima ubicaci√≥n
  - **Restricciones de movimiento**: Los jugadores normales pueden moverse a habitaciones contiguas o quedarse en la misma ubicaci√≥n
```

</details>

---

Ahora voy a a√±adir una nueva secci√≥n espec√≠fica para el minijuego de sonidos despu√©s de la secci√≥n de rondas:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 15, lines removed: undefined

```diff
@@ -547,4 +547,19 @@
  - **Finalizaci√≥n autom√°tica**: La ronda se finaliza autom√°ticamente cuando todos han movido
  - **Rec√°lculo de visibilidad**: Nueva distribuci√≥n y visibilidad se calculan autom√°ticamente al finalizar
+ 
+ ### üéµ Sistema de Minijuego de Sonidos
+ - **Activaci√≥n autom√°tica**: Se activa cuando el jugador 1 pulsa "SIGUIENTE RONDA" despu√©s del movimiento
+ - **5 fases del minijuego**:
+   1. **MOVERSE**: Pantalla con bot√≥n "MOVERSE" y texto "CONTENED LA RESPIRACION - Pulsad 'MOVER' a la vez"
+   2. **PREP√ÅRATE**: Contador regresivo 5-4-3-2-1-0 con texto "Los movimientos ocurrir√°n en..."
+   3. **INVESTIGACI√ìN**: Bot√≥n "INVESTIGAR" con texto "¬øQu√© movimiento escuchaste de cada jugador?"
+   4. **SELECCI√ìN DE SONIDOS**: Interfaz para seleccionar qu√© sonido escuch√≥ cada jugador (SONIDO 1, 2 o 3)
+   5. **ESPERANDO**: Pantalla de espera hasta que todos completen la investigaci√≥n
+ - **Sistema de sonidos**: 3 sonidos diferentes asignados aleatoriamente a cada jugador
+ - **Botones de referencia**: Permiten escuchar cada sonido antes de hacer la selecci√≥n
+ - **C√°lculo de accuracy**: Porcentaje de aciertos que reemplaza la probabilidad fija del 60%
+ - **Integraci√≥n con visibilidad**: La visibilidad se calcula bas√°ndose en el accuracy personalizado de cada jugador
+ - **Sincronizaci√≥n**: Todos los jugadores deben completar la investigaci√≥n antes de continuar
+ - **Persistencia**: Los datos de accuracy se almacenan en Firebase para referencia futura
  
  ### üî™ Mec√°nica de Asesinato Optimizada
```

</details>

---

Ahora voy a actualizar la secci√≥n de tecnolog√≠as para incluir el sistema de audio:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 2, lines removed: undefined

```diff
@@ -254,4 +254,6 @@
  - **Autenticaci√≥n**: Sistema de login an√≥nimo con gesti√≥n de sesiones
  - **Arquitectura Firebase**: Patr√≥n modular con singleton, cach√© persistente y soporte multi-tab
+ - **Sistema de audio**: Reproducci√≥n de sonidos MP3 en navegador para minijuegos interactivos
+ - **Minijuegos interactivos**: Sistema de fases y estados del juego con sincronizaci√≥n en tiempo real
  
  ## üìÅ Estructura del proyecto
```

</details>

---

Ahora voy a actualizar la secci√≥n de pr√≥ximas funcionalidades para mover el minijuego de sonidos a las caracter√≠sticas implementadas:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -639,4 +639,5 @@
  - [x] **Arquitectura Firebase "a prueba de bombas"** - Implementaci√≥n del patr√≥n recomendado por GPT5 para evitar errores de reconexi√≥n
  - [x] **Sistema de anotaci√≥n de preguntas** - Bot√≥n "ANOTAR PREGUNTA" para contabilizar preguntas de cada jugador con visualizaci√≥n de palos "I" debajo de avatares
+ - [x] **üéµ Sistema de minijuego de sonidos** - Nueva mec√°nica que reemplaza la probabilidad fija del 60% por un sistema basado en habilidad con 5 fases y c√°lculo de accuracy personalizado
  - [ ] **Base de datos de pistas** - Sistema de pistas din√°micas y aleatorias
  - [x] **Modo multijugador** - Sincronizaci√≥n en tiempo real entre jugadores
```

</details>

---

Finalmente, voy a actualizar la secci√≥n de caracter√≠sticas del juego para incluir el nuevo t√≠tulo del juego:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -5,5 +5,5 @@
  ## üéØ ¬øQu√© es WHO LIES?
  
- **WHO LIES** es un juego de misterio y deducci√≥n donde los jugadores deben triangular informaci√≥n para descubrir qui√©n es el asesino. El juego se desarrolla en un entorno de "murder mystery" similar a Cluedo, pero con un enfoque en la triangulaci√≥n de pistas y la l√≥gica deductiva.
+ **WHO LIES** (tambi√©n conocido como **PEDOCIDIO**) es un juego de misterio y deducci√≥n donde los jugadores deben triangular informaci√≥n para descubrir qui√©n es el asesino. El juego se desarrolla en un entorno de "murder mystery" similar a Cluedo, pero con un enfoque en la triangulaci√≥n de pistas y la l√≥gica deductiva.
  
  ### üéÆ Concepto del juego
```

</details>

---

Ahora voy a a√±adir informaci√≥n sobre el subt√≠tulo actualizado:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -132,4 +132,5 @@
  - **Responsive**: Optimizado para pantallas verticales de dispositivos m√≥viles
  - **Tipograf√≠a**: Fuente Georgia para dar un toque cl√°sico y elegante
+ - **Subt√≠tulo del juego**: "Cuando los invitados huelen a podrido..." - Referencia tem√°tica al misterio
  
  ### üîß Evoluci√≥n t√©cnica
```

</details>

---

Perfecto! He actualizado el README.md con toda la informaci√≥n sobre las nuevas funcionalidades implementadas en los √∫ltimos commits. Aqu√≠ est√° el resumen de las actualizaciones realizadas:

## ‚úÖ **README.md Actualizado con las Nuevas Funcionalidades:**

### ÔøΩÔøΩ **Sistema de Minijuego de Sonidos**
- **5 fases del minijuego** documentadas: MOVERSE ‚Üí PREP√ÅRATE ‚Üí INVESTIGACI√ìN ‚Üí SELECCI√ìN ‚Üí ESPERANDO
- **Sistema de audio integrado** con 3 sonidos diferentes
- **C√°lculo de accuracy** que reemplaza la probabilidad fija del 60%
- **Integraci√≥n con visibilidad** basada en habilidad personalizada

### üéØ **Estados del Juego Documentados**
- **TALKING**: Modo normal de discusi√≥n
- **MOVING**: Modo de movimiento de jugadores
- **MINIGAME_ACTIVE**: Activaci√≥n del minijuego de sonidos
- **TALKING**: Vuelta al modo normal

### üéÆ **Nuevas Caracter√≠sticas del Juego**
- **T√≠tulo actualizado**: "PEDOCIDIO" 
- **Subt√≠tulo**: "Cuando los invitados huelen a podrido..."
- **Sistema de minijuegos interactivos** con sincronizaci√≥n en tiempo real
- **Sistema de audio** para navegadores

### üîß **Actualizaciones T√©cnicas**
- **Tecnolog√≠as a√±adidas**: Sistema de audio MP3 y minijuegos interactivos
- **Funcionalidades implementadas**: Minijuego de sonidos movido a caracter√≠sticas completadas
- **Estructura del juego**: Flujo completo de estados documentado

El README.md ahora refleja completamente el estado actual del proyecto, incluyendo todas las funcionalidades del minijuego de sonidos que se implementaron en los √∫ltimos commits, as√≠ como la informaci√≥n detallada sobre los estados del juego y el flujo de rondas.

---

