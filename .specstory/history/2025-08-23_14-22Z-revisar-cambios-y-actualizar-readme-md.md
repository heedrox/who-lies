<!-- Generated by SpecStory -->

# Revisar cambios y actualizar README.md (2025-08-23 14:22Z)

_**User**_

Mira los cambios de los últimos 4 commits, y mira si hay algo pendiente por actualizar en @README.md 

---

_**Assistant**_

Voy a revisar los últimos 4 commits para ver qué cambios se han realizado y si hay algo pendiente por actualizar en el README.md.


---

```bash
cd /Users/jordimarti/Development/who-lies && git log --oneline -4
```

```
(base) ➜  who-lies cd /Users/jordimarti/Development/who-lies && git log --oneline -4               cd /Users
/jordimarti/Development/who-lies && git log --oneline -4
d3c9867 (HEAD -> main, origin/main) change texts
55e8d94 primero moverse, luego el juego
1d2b5d9 change game name temporariliy
4078cdf test sound minigames
(base) ?➜  who-lies git:(main)
```

---

Ahora voy a revisar los detalles de cada uno de estos commits para entender qué cambios se han realizado:


---

```bash
git show --stat d3c9867
```

```
(base) ➜  who-lies git:(main) git show --stat d3c9867
commit d3c9867e7f17eb7a40244d1cab398925b6b6843b (HEAD -> main, origin/main)
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 16:26:54 2025 +0200

    change texts

 web/index.html | 25 +++++++++++++------------
 1 file changed, 13 insertions(+), 12 deletions(-)
```

---

```bash
git show --stat 55e8d94
```

```
(base) ➜  who-lies git:(main) git show --stat 55e8d94
commit 55e8d944f1f188909608357d6aa8f819b0683e80
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 16:21:52 2025 +0200

    primero moverse, luego el juego

 ...025-08-23_11-25Z-desarrollo-de-nueva-mec\303\241nica-de-juego.md" | 7838 ++++++++++++++++++++++++++++++
 .specstory/history/2025-08-23_13-28Z-cortar-audio-a-1-5-segundos.md  |  308 ++
 web/firebase-modular.js                                              |    9 +-
 web/index.html                                                       |  744 ++-
 web/sounds/sound-2.mp3                                               |  Bin 12960 -> 29804 bytes
 web/sounds/sound-3.mp3                                               |  Bin 96000 -> 30764 bytes
 6 files changed, 8744 insertions(+), 155 deletions(-)
```

---

```bash
git show --stat 1d2b5d9
```

```
(base) ➜  who-lies git:(main) git show --stat 1d2b5d9
commit 1d2b5d91c7cc8b140662fcf47dc62387142e1093
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 14:31:56 2025 +0200

    change game name temporariliy

 web/index.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
```

---

```bash
git show --stat 4078cdf
```

```
(base) ➜  who-lies git:(main) git show --stat 4078cdf
commit 4078cdfa252ad19fcc6698a73516c6508449bdcc
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 14:30:50 2025 +0200

    test sound minigames

 ...025-08-23_11-25Z-desarrollo-de-nueva-mec\303\241nica-de-juego.md" | 3476 ++++++++++++++++++++++++++++++
 docs/features/0002_PLAN.md                                           |  141 ++
 web/firebase-modular.js                                              |  139 +-
 web/index.html                                                       |  948 +++++++-
 web/sounds/sound-1.mp3                                               |  Bin 0 -> 44544 bytes
 web/sounds/sound-2.mp3                                               |  Bin 0 -> 12960 bytes
 web/sounds/sound-3.mp3                                               |  Bin 0 -> 96000 bytes
 7 files changed, 4699 insertions(+), 5 deletions(-)
```

---

Ahora voy a revisar los cambios específicos en el archivo `web/index.html` para entender mejor qué funcionalidades se han añadido:


---

```bash
git show d3c9867:web/index.html | grep -A 5 -B 5 "minigame\|sound\|audio"
```

```

            justify-content: center;
        }

        /* ===== ESTILOS DEL MINIJUEGO DE SONIDOS ===== */
        
        .sound-minigame-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
--
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease-in-out;
        }

        .minigame-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .minigame-title {
            color: #8B4513;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .minigame-description {
            color: #654321;
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .minigame-btn {
            background: linear-gradient(145deg, #8B4513, #A0522D);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 1.3rem;
--
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 250px;
        }

        .minigame-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            background: linear-gradient(145deg, #A0522D, #CD853F);
        }

        .minigame-btn:active {
            transform: translateY(-1px);
        }

        .minigame-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .countdown-display {
--
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .sound-selection-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .player-sound-item {
            background: rgba(139, 69, 19, 0.1);
            border: 2px solid #8B4513;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .player-sound-header {
            font-weight: bold;
            color: #8B4513;
            font-size: 1.2rem;
        }

        .sound-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .sound-option {
            background: linear-gradient(145deg, #8B4513, #A0522D);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
--
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .sound-option:hover {
            transform: translateY(-2px);
            background: linear-gradient(145deg, #A0522D, #CD853F);
        }

        .sound-option.selected {
            background: linear-gradient(145deg, #4CAF50, #45a049) !important;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
            border: 2px solid #45a049;
            color: white;
            font-weight: bold;
        }

        .sound-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .continue-btn {
--
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .minigame-phase {
            display: block;
        }

        .selection-progress {
            background: rgba(139, 69, 19, 0.1);
--
            font-weight: bold;
        }

        /* ===== ESTILOS PARA BOTONES DE REFERENCIA DE SONIDOS ===== */
        
        .sound-reference-buttons {
            background: rgba(70, 130, 180, 0.1);
            border: 2px solid #4682B4;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
--
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .reference-sound-btn {
            background: linear-gradient(145deg, #4682B4, #5F9EA0);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 25px;
--
            gap: 8px;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(70, 130, 180, 0.3);
        }

        .reference-sound-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(70, 130, 180, 0.4);
            background: linear-gradient(145deg, #5F9EA0, #4682B4);
        }

        .reference-sound-btn:active {
            transform: translateY(0);
        }



        .sound-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .sound-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Efecto de reproducción */
        .reference-sound-btn.playing {
            background: linear-gradient(145deg, #FFD700, #FFA500) !important;
            color: #333;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .reference-sound-btn.playing .sound-number {
            color: #FF4500;
        }

        /* Modal de acusación */
        .accusation-modal {
--
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        
        /* Estilos para información de aciertos del minijuego */
        .minigame-accuracy-info {
            margin-top: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border-radius: 8px;
            text-align: center;
--
            <button class="end-round-btn" onclick="endRound()" style="display: none;">TERMINAR RONDA</button
>

            <button class="add-question-btn" onclick="addQuestion()" style="display: none;">ANOTAR PREGUNTA<
/button>

        </footer>

        <!-- Overlay del Minijuego de Sonidos -->
        <div id="sound-minigame-overlay" class="sound-minigame-overlay" style="display: none;">
            <div class="minigame-container">
                <!-- Fase 1: Botón MOVERSE -->
                <div id="move-phase" class="minigame-phase">
                    <h2 class="minigame-title">CONTENED LA RESPIRACION</h2>
                    <p class="minigame-description">Pulsad "MOVER" a la vez</p>
                    <button id="move-btn" class="minigame-btn move-btn" onclick="startMovementPhase()">
                        MOVERSE
                    </button>
                </div>

                <!-- Fase 2: Contador regresivo -->
                <div id="countdown-phase" class="minigame-phase" style="display: none;">
                    <h2 class="minigame-title">PREPÁRATE</h2>
                    <div id="countdown-display" class="countdown-display">5</div>
                    <p class="minigame-description">Los movimientos ocurrirán en...</p>
                </div>

                <!-- Fase 3: Botón INVESTIGAR -->
                <div id="investigate-phase" class="minigame-phase" style="display: none;">
                    <h2 class="minigame-title">🔍 INVESTIGACIÓN</h2>
                    <p class="minigame-description">¿Qué movimiento escuchaste de cada jugador?</p>
                    <button id="investigate-btn" class="minigame-btn investigate-btn" onclick="showSoundSele
ctionInterface()">

                        INVESTIGAR
                    </button>
                </div>

                <!-- Fase 4: Selección de sonidos -->
                <div id="sound-selection-phase" class="minigame-phase" style="display: none;">
                    <h2 class="minigame-title">🎵 SELECCIONA SONIDOS</h2>
                    <p class="minigame-description">Para cada jugador, selecciona qué sonido escuchaste:</p>
                    
                    <!-- Botones de referencia de sonidos -->
                    <div id="sound-reference-buttons" class="sound-reference-buttons">
                        <div class="reference-buttons-container">
                            <button class="reference-sound-btn" onclick="playReferenceSound(1)">
                                <span class="sound-label">SONIDO 1</span>
                            </button>
                            <button class="reference-sound-btn" onclick="playReferenceSound(2)">
                                <span class="sound-label">SONIDO 2</span>
                            </button>
                            <button class="reference-sound-btn" onclick="playReferenceSound(3)">
                                <span class="sound-label">SONIDO 3</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="sound-selection-list" class="sound-selection-list">
                        <!-- Se llenará dinámicamente -->
                    </div>
                    
                    <!-- Indicador de progreso -->
                    <div id="selection-progress" class="selection-progress" style="display: none;">
                        <p>Seleccionados: <span id="selected-count">0</span> de <span id="total-count">0</sp
an> jugadores</p>

                    </div>
                    
                    <button id="continue-investigation-btn" class="minigame-btn continue-btn" onclick="conti
nueInvestigation()" style="display: none;">

                        CONTINUAR INVESTIGACIÓN
                    </button>
                </div>

                <!-- Fase 5: Esperando a otros jugadores -->
                <div id="waiting-phase" class="minigame-phase" style="display: none;">
                    <h2 class="minigame-title">⏳ ESPERANDO</h2>
                    <p class="minigame-description">Esperando a que todos los jugadores completen la investi
gación...</p>

                    <div class="loading-spinner">🔄</div>
                </div>
            </div>
        </div>

--
                console.log('🚨🚨🚨 FUNCIÓN generatePlayerVisibility EJECUTÁNDOSE 🚨🚨🚨');
                console.log('👁️ Generando visibilidad entre jugadores...');
                console.log('📊 Parámetros recibidos:', { playerDistribution, roles });
                
                // Verificar si hay datos del minijuego disponibles
                if (!window.gameData || !window.gameData.soundSelections || !window.gameData.movementSounds)
 {

                    console.log('❌ No hay datos del minijuego disponibles, no se puede generar visibilidad')
;                                                                                                          
                    console.log('📊 Datos disponibles:', {
                        hasGameData: !!window.gameData,
                        hasGameData: !!window.gameData,
                        hasSoundSelections: !!window.gameData?.soundSelections,
                        hasMovementSounds: !!window.gameData?.movementSounds
                    });
                    return {}; // Retornar visibilidad vacía si no hay datos
                }
                
--
                        
                        // Para ASESINO y CÓMPLICE: solo verificar aciertos del minijuego (ignorar línea de
visibilidad)

                        if (playerRole === 'ASESINO/A' || playerRole === 'COMPLICE') {
                            console.log(`👑 ${playerRole} ${playerNum}: verificando solo aciertos del miniju
ego (ignorando línea de visibilidad)`);

                            
                            if (window.gameData.soundSelections[playerNum]) {
                                try {
                                    // Verificar si acertó el sonido de este jugador específico
                                    const playerSelections = window.gameData.soundSelections[playerNum];
                                    const actualSound = window.gameData.movementSounds[otherPlayerNum];
                                    const guessedSound = playerSelections[otherPlayerNum];
                                    
                                    console.log(`🔍 ${playerRole} ${playerNum} vs ${otherPlayerNum}: Adivinó
 ${guessedSound}, Era ${actualSound}`);

                                    
--
                            const canSee = window.roomVisibility[playerRoom] && 
                                          window.roomVisibility[playerRoom].includes(otherPlayerRoom);
                            
                            if (canSee) {
                                // Verificar si acertó a este jugador específico en el minijuego
                                if (window.gameData.soundSelections[playerNum]) {
                                    try {
                                        // Verificar si acertó el sonido de este jugador específico
                                        const playerSelections = window.gameData.soundSelections[playerNum];
                                        const actualSound = window.gameData.movementSounds[otherPlayerNum];
                                        const guessedSound = playerSelections[otherPlayerNum];
                                        
                                        console.log(`🔍 INVITADO ${playerNum} vs ${otherPlayerNum}: Adivinó
${guessedSound}, Era ${actualSound}`);

                                        
--
            
            console.log('🔄 Actualización en tiempo real recibida:', gameData);
            console.log('🔄 Estado actual del juego:', gameData.state);
            console.log('📊 Campos importantes del juego:', {
                state: gameData.state,
                minigameAccuracy: gameData.minigameAccuracy,
                soundSelections: gameData.soundSelections,
                movementSounds: gameData.movementSounds,
                investigationCompleted: gameData.investigationCompleted
            });
            
            // Actualizar barra de ronda
--
                }
                
            } else if (gameData.state === "MINIGAME_ACTIVE") {
                // Verificar si se activó el minijuego de sonidos
                // Solo activar si no está ya activo o si está en fase inicial
                const overlay = document.getElementById('sound-minigame-overlay');
                const isMinigameActive = overlay && overlay.style.display !== 'none';
                
                if (!isMinigameActive) {
                    console.log('🎵 Minijuego de sonidos activado para todos los jugadores');
                    activateSoundMinigame();
--
                    const { doc, updateDoc, serverTimestamp } = window.firebaseServices;
                    
                    // CALCULAR ACCURACY ANTES DE LIMPIAR LOS DATOS
                    console.log('🎯 Calculando accuracy del minijuego antes de limpiar...');
                    console.log('📊 Datos disponibles para cálculo:', {
                        soundSelections: gameData.soundSelections,
                        movementSounds: gameData.movementSounds,
                        totalPlayers: window.gameParams.totalPlayers
                    });
                    
                    const minigameAccuracy = {};
                    
                    if (gameData.soundSelections && gameData.movementSounds) {
                        console.log('✅ Datos del minijuego disponibles, calculando accuracy...');
                        
                        for (let playerNum = 1; playerNum <= window.gameParams.totalPlayers; playerNum++) {
                            const playerSelections = gameData.soundSelections[playerNum];
                            console.log(`🎵 Jugador ${playerNum} - Selecciones:`, playerSelections);
                            
                            if (playerSelections) {
                                let correctGuesses = 0;
                                let totalGuesses = 0;
--
                                    totalGuesses++;
                                }
                                
                                if (totalGuesses > 0) {
                                    const accuracyPercentage = Math.round((correctGuesses / totalGuesses) *
100);

                                    minigameAccuracy[playerNum] = accuracyPercentage;
                                    console.log(`🎯 Jugador ${playerNum}: ${correctGuesses}/${totalGuesses}
aciertos = ${accuracyPercentage}%`);

                                }
                            } else {
                                console.log(`⚠️ Jugador ${playerNum} no tiene selecciones de sonidos`);
                            }
                        }
                    } else {
                        console.log('❌ Datos del minijuego no disponibles para calcular accuracy');
                        console.log('soundSelections:', gameData.soundSelections);
                        console.log('movementSounds:', gameData.movementSounds);
                    }
                    
                    console.log('📊 Accuracy calculado:', minigameAccuracy);
                    
                    // Guardar accuracy y limpiar datos del minijuego
                    const updateData = {
                        state: "TALKING",
                        minigameAccuracy: minigameAccuracy, // Guardar accuracy calculado
                        movementSounds: null,
                        soundSelections: null,
                        investigationCompleted: null,
                        lastUpdated: serverTimestamp()
                    };
                    
                    console.log('💾 Guardando en Firebase:', updateData);
                    
                    await updateDoc(doc(db, 'games', window.gameParams.gameCode), updateData);
                    
                    console.log('🎵 Estado del minijuego limpiado, accuracy guardado:', minigameAccuracy);
                    
                    // Ocultar el overlay del minijuego si está visible
                    hideSoundMinigame();
                    
                } catch (error) {
--
            playersStatusHTML += '</div>';
            
            // Agregar información de aciertos del minijuego si está disponible (solo en fase TALKING)
            console.log('🔍 Debug showDeadsInfo - Estado del juego:', {
                state: window.gameData?.state,
                hasMinigameAccuracy: !!window.gameData?.minigameAccuracy,
                currentPlayerAccuracy: window.gameData?.minigameAccuracy?.[window.gameParams?.playerNumber],
                totalPlayers: totalPlayers
            });
            
            if (window.gameData && window.gameData.state === 'TALKING' && 
                window.gameData.minigameAccuracy && 
                window.gameData.minigameAccuracy[window.gameParams?.playerNumber] !== undefined) {
                
                console.log('✅ Condiciones cumplidas para mostrar accuracy del minijuego');
                
                const playerNumber = window.gameParams.playerNumber;
                const accuracyPercentage = window.gameData.minigameAccuracy[playerNumber];
                const totalPlayers = window.gameParams.totalPlayers;
                const correctGuesses = Math.round((accuracyPercentage / 100) * totalPlayers);
                
                playersStatusHTML += `
                    <div class="minigame-accuracy-info">
                        <span class="accuracy-label">🎯 Acertaste ${correctGuesses} de ${totalPlayers} sonid
os (${accuracyPercentage}%)</span>

                    </div>
                `;
                console.log(`🎯 Jugador ${playerNumber}: ${correctGuesses}/${totalPlayers} aciertos = ${accu
racyPercentage}%`);

                
--
                        const { doc, updateDoc, serverTimestamp } = window.firebaseServices;
                        
                        await updateDoc(doc(db, 'games', window.gameParams.gameCode), {
                            state: "TALKING",
                            movementSounds: null,
                            soundSelections: null,
                            investigationCompleted: null,
                            lastUpdated: serverTimestamp(),
                            playerVisibility: {}
                        });
                        
--
                console.log('🔍 Verificando datos del minijuego...');
                console.log('🔍 window.gameData:', window.gameData);
                console.log('🔍 movementSounds:', window.gameData?.movementSounds);
                
                // Mostrar overlay del minijuego
                const overlay = document.getElementById('sound-minigame-overlay');
                if (overlay) {
                    overlay.style.display = 'flex';
                }
                
                // Solo resetear a fase inicial si se fuerza o si no hay fase activa
--
        function hideSoundMinigame() {
            try {
                console.log('🎵 Ocultando minijuego de sonidos...');
                
                // Ocultar overlay del minijuego
                const overlay = document.getElementById('sound-minigame-overlay');
                if (overlay) {
                    overlay.style.display = 'none';
                }
                
                // Limpiar selecciones temporales
--
        function showMinigamePhase(phaseId) {
            // Guardar la fase actual globalmente
            window.currentMinigamePhase = phaseId;
            
            // Ocultar todas las fases
            const phases = document.querySelectorAll('.minigame-phase');
            phases.forEach(phase => {
                phase.style.display = 'none';
            });
            
            // Mostrar la fase solicitada
--
                if (!assignedSound) {
                    console.error(`❌ No hay sonido asignado al jugador ${playerNumber}`);
                    return;
                }
                
                // Crear y reproducir el audio
                const audio = new Audio(`sounds/sound-${assignedSound}.mp3`);
                audio.volume = 0.7;
                
                try {
                    await audio.play();
                    console.log(`🎵 Sonido ${assignedSound} reproducido para jugador ${playerNumber}`);
                } catch (playError) {
                    console.error('❌ Error al reproducir audio:', playError);
                }
                
                // Cambiar a fase de investigación
                showMinigamePhase('investigate-phase');
                
--
        async function showSoundSelectionInterface() {
            try {
                console.log('🎵 Mostrando interfaz de selección de sonidos...');
                
                // Cambiar a fase de selección
                showMinigamePhase('sound-selection-phase');
                
                // Generar lista de jugadores para selección
                await generateSoundSelectionList();
                
            } catch (error) {
--
                    return;
                }
                
                const totalPlayers = window.gameParams.totalPlayers;
                const playerNumber = window.gameParams.playerNumber;
                const soundSelectionList = document.getElementById('sound-selection-list');
                
                if (!soundSelectionList) {
                    console.error('❌ Elemento de lista de selección no encontrado');
                    return;
                }
                
                // Limpiar lista anterior
                soundSelectionList.innerHTML = '';
                
                // Crear elementos para cada jugador
                for (let i = 1; i <= totalPlayers; i++) {
                    const playerItem = document.createElement('div');
                    playerItem.className = 'player-sound-item';
                    playerItem.dataset.player = i;
                    
                    const playerHeader = document.createElement('div');
                    playerHeader.className = 'player-sound-header';
                    playerHeader.textContent = `JUGADOR ${i}`;
                    
                    const soundOptions = document.createElement('div');
                    soundOptions.className = 'sound-options';
                    
                    // Crear opciones de sonido (1, 2, 3)
                    for (let sound = 1; sound <= 3; sound++) {
                        const soundOption = document.createElement('button');
                        soundOption.className = 'sound-option';
                        soundOption.textContent = `SONIDO ${sound}`;
                        soundOption.dataset.sound = sound;
                        
                        // El jugador también debe averiguar su propio sonido
                        // No deshabilitar la selección del jugador actual
                        
                        // Event listener para selección
                        soundOption.addEventListener('click', function() {
                            selectSoundForPlayer(i, sound);
                        });
                        
                        soundOptions.appendChild(soundOption);
                    }
                    
                    playerItem.appendChild(playerHeader);
                    playerItem.appendChild(soundOptions);
                    soundSelectionList.appendChild(playerItem);
                }
                
                // Mostrar botón de continuar solo para el jugador 1
                const continueBtn = document.getElementById('continue-investigation-btn');
                if (continueBtn) {
--
                console.error('❌ Error al generar lista de selección:', error);
            }
        }

        // Función para seleccionar sonido para un jugador específico
        async function selectSoundForPlayer(playerNum, soundNum) {
            try {
                // Obtener el contenedor del jugador
                const playerItem = document.querySelector(`[data-player="${playerNum}"]`);
                if (!playerItem) {
                    console.error(`❌ No se encontró el contenedor del jugador ${playerNum}`);
                    return;
                }
                
                // Obtener todas las opciones de sonido para este jugador
                const soundOptions = playerItem.querySelectorAll('.sound-option');
                
                // Verificar si ya está seleccionado este sonido
                const currentlySelected = window.tempSoundSelections && window.tempSoundSelections[playerNum
];

                
                if (currentlySelected === soundNum) {
                    // Si se hace clic en el mismo sonido, deseleccionarlo
                    soundOptions.forEach(option => {
                        option.classList.remove('selected');
                    });
                    
                    // Remover de las selecciones temporales
                    if (window.tempSoundSelections) {
                        delete window.tempSoundSelections[playerNum];
                    }
                    
                    console.log(`🎵 Sonido ${soundNum} deseleccionado para jugador ${playerNum}`);
                    
                    // Guardar deselección en Firebase
                    await saveSoundSelectionToFirebase(playerNum, null);
                    
                    // Actualizar indicador de progreso
                    updateSelectionProgress();
                    return;
                }
                
                // Deseleccionar todas las opciones para este jugador
                soundOptions.forEach(option => {
                    option.classList.remove('selected');
                });
                
                // Seleccionar la nueva opción
                const targetOption = playerItem.querySelector(`[data-sound="${soundNum}"]`);
                if (targetOption) {
                    targetOption.classList.add('selected');
                }
                
                // Almacenar selección temporalmente
                if (!window.tempSoundSelections) {
                    window.tempSoundSelections = {};
                }
                window.tempSoundSelections[playerNum] = soundNum;
                
                console.log(`🎵 Sonido ${soundNum} seleccionado para jugador ${playerNum}`);
                
                // Guardar selección en Firebase
                await saveSoundSelectionToFirebase(playerNum, soundNum);
                
                // Actualizar indicador de progreso
                updateSelectionProgress();
                
            } catch (error) {
--
            }
        }

        // Función para guardar selección de sonido en Firebase en tiempo real
        // Se ejecuta cada vez que se selecciona/deselecciona un sonido
        async function saveSoundSelectionToFirebase(playerNum, soundNum) {
            try {
                if (!window.gameParams) {
                    console.error('❌ Parámetros del juego no disponibles');
                    return;
                }
                
                const { db } = window.FirebaseModular.getFirebaseServices();
                const { doc, updateDoc, serverTimestamp } = window.firebaseServices;
                
                // Crear objeto de selección para este jugador
                const soundSelection = {};
                soundSelection[`soundSelections.${window.gameParams.playerNumber}.${playerNum}`] = soundNum;
                
                // Solo marcar como completado si todos los sonidos están seleccionados
                const allSelectionsComplete = checkAllSelectionsComplete();
                if (allSelectionsComplete) {
                    soundSelection[`investigationCompleted.${window.gameParams.playerNumber}`] = true;
                }
                
                // Actualizar Firebase
                await updateDoc(doc(db, 'games', window.gameParams.gameCode), {
                    ...soundSelection,
                    lastUpdated: serverTimestamp()
                });
                
                console.log(`🎵 Sonido ${soundNum || 'deseleccionado'} para jugador ${playerNum} guardado en
 Firebase`);

                
            } catch (error) {
                console.error('❌ Error al guardar selección en Firebase:', error);
            }
        }
--
                        const newDistribution = await calculateNewDistribution();
                        
                        // Generar nueva visibilidad basada en aciertos del minijuego (AHORA SÍ hay datos)
                        console.log('👁️ Generando visibilidad basada en datos reales del minijuego...');
                        console.log('📊 Datos del minijuego disponibles para generar visibilidad:', {
                            soundSelections: window.gameData.soundSelections,
                            movementSounds: window.gameData.movementSounds,
                            roles: window.gameData.roles,
                            newDistribution: newDistribution
                        });
                        
--
                        await window.FirebaseModular.finalizeRound(window.gameParams.gameCode, newDistributi
on, newVisibility);

                        
                        // CALCULAR ACCURACY ANTES DE LIMPIAR LOS DATOS
                        console.log('🎯 Calculando accuracy del minijuego antes de limpiar...');
                        console.log('📊 Datos disponibles para cálculo:', {
                            soundSelections: window.gameData.soundSelections,
                            movementSounds: window.gameData.movementSounds,
                            totalPlayers: window.gameParams.totalPlayers
                        });
                        
                        const minigameAccuracy = {};
                        
                        if (window.gameData.soundSelections && window.gameData.movementSounds) {
                            console.log('✅ Datos del minijuego disponibles, calculando accuracy...');
                            
                            for (let playerNum = 1; playerNum <= window.gameParams.totalPlayers; playerNum++
) {

                                const playerSelections = window.gameData.soundSelections[playerNum];
                                console.log(`🎵 Jugador ${playerNum} - Selecciones:`, playerSelections);
                                
                                if (playerSelections) {
                                    let correctGuesses = 0;
                                    let totalGuesses = 0;
--
                                        totalGuesses++;
                                    }
                                    
                                    if (totalGuesses > 0) {
                                        const accuracyPercentage = Math.round((correctGuesses / totalGuesses
) * 100);

                                        minigameAccuracy[playerNum] = accuracyPercentage;
                                        console.log(`🎯 Jugador ${playerNum}: ${correctGuesses}/${totalGuess
es} aciertos = ${accuracyPercentage}%`);

                                    }
                                } else {
                                    console.log(`⚠️ Jugador ${playerNum} no tiene selecciones de sonidos`);
                                }
                            }
                        } else {
                            console.log('❌ Datos del minijuego no disponibles para calcular accuracy');
                            console.log('soundSelections:', window.gameData.soundSelections);
                            console.log('movementSounds:', window.gameData.movementSounds);
                        }
                        
                        console.log('📊 Accuracy calculado:', minigameAccuracy);
                        
                        // Limpiar estado del minijuego y modo de movimiento
                        const { db } = window.FirebaseModular.getFirebaseServices();
                        const { doc, updateDoc, serverTimestamp } = window.firebaseServices;
                        
                        const updateData = {
                            state: "TALKING",
                            minigameAccuracy: minigameAccuracy, // Guardar accuracy calculado
                            movementSounds: null,
                            soundSelections: null,
                            investigationCompleted: null,
                            lastUpdated: serverTimestamp()
                        };
                        
                        console.log('💾 Guardando en Firebase:', updateData);
                        
                        await updateDoc(doc(db, 'games', window.gameParams.gameCode), updateData);
                        
                        console.log('🎵 Estado del minijuego y modo de movimiento limpiados, accuracy guarda
do:', minigameAccuracy);

                        console.log('✅ Ronda finalizada exitosamente con nueva visibilidad basada en acierto
s');                                                                                                       
                        console.log('🎯 Estado cambiado a TALKING en Firebase, esperando sincronización...')
;

                        console.log('🔄 En 2 segundos se debería ocultar el modo de movimiento automáticamen
te');

                        
                    } catch (error) {
--
        }



        // Función para reproducir sonidos de referencia
        async function playReferenceSound(soundNumber) {
            try {
                console.log(`🎵 Reproduciendo sonido de referencia ${soundNumber}...`);
                
                // Obtener el botón del sonido
                const soundButton = document.querySelector(`[onclick="playReferenceSound(${soundNumber})"]`)
;

                if (!soundButton) {
                    console.error(`❌ No se encontró el botón del sonido ${soundNumber}`);
                    return;
                }
                
                // Verificar si ya hay un sonido reproduciéndose
                const currentlyPlaying = document.querySelector('.reference-sound-btn.playing');
                if (currentlyPlaying) {
                    console.log('🎵 Ya hay un sonido reproduciéndose, esperando...');
                    return;
                }
                
                // Aplicar efecto visual de reproducción
                soundButton.classList.add('playing');
                
                // Crear y reproducir el audio
                const audio = new Audio(`sounds/sound-${soundNumber}.mp3`);
                audio.volume = 0.8;
                
                try {
                    await audio.play();
                    console.log(`🎵 Sonido de referencia ${soundNumber} reproducido`);
                    
                    // Mantener el efecto visual durante la reproducción
                    const audioDuration = audio.duration || 2000; // 2 segundos por defecto si no se puede o
btener la duración

                    
                    setTimeout(() => {
                        // Remover efecto visual
                        soundButton.classList.remove('playing');
                    }, audioDuration * 1000);
                    
                } catch (playError) {
                    console.error('❌ Error al reproducir audio de referencia:', playError);
                    
                    // Remover efecto visual en caso de error
                    soundButton.classList.remove('playing');
                }
                
            } catch (error) {
                console.error(`❌ Error al reproducir sonido de referencia ${soundNumber}:`, error);
            }
        }

        // Agregar efectos de hover adicionales
        document.querySelectorAll('.room').forEach(room => {
```

---

Ahora voy a revisar el commit más reciente para ver exactamente qué cambios de texto se realizaron:


---

```bash
git show d3c9867
```

```

commit d3c9867e7f17eb7a40244d1cab398925b6b6843b (HEAD -> main, origin/main)
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 16:26:54 2025 +0200

    change texts

diff --git a/web/index.html b/web/index.html
index 271ff72..4c12b58 100644
--- a/web/index.html
+++ b/web/index.html
@@ -1496,7 +1496,7 @@
 <body>
     <header class="header">
         <h1>PEDOCIDIO</h1>
-        <div class="subtitle">Algo huele aquí a podrido...</div>
+        <div class="subtitle">Cuando los invitados huelen a podrido...</div>
         <button id="reload-page-btn" class="reload-page-btn" onclick="window.location.reload()" title="Reca
rgar página">🔄</button>

         <button id="restart-game-btn" class="restart-game-btn" onclick="restartGame()">REINICIAR</button>
     </header>
@@ -1611,8 +1611,8 @@
             <div class="minigame-container">
                 <!-- Fase 1: Botón MOVERSE -->
                 <div id="move-phase" class="minigame-phase">
-                    <h2 class="minigame-title">🎵 MINIJUEGO DE SONIDOS</h2>
-                    <p class="minigame-description">Prepárate para moverte y escuchar sonidos</p>
+                    <h2 class="minigame-title">CONTENED LA RESPIRACION</h2>
+                    <p class="minigame-description">Pulsad "MOVER" a la vez</p>
                     <button id="move-btn" class="minigame-btn move-btn" onclick="startMovementPhase()">
                         MOVERSE
                     </button>
@@ -1620,15 +1620,15 @@
 
                 <!-- Fase 2: Contador regresivo -->
                 <div id="countdown-phase" class="minigame-phase" style="display: none;">
-                    <h2 class="minigame-title">🎵 PREPÁRATE</h2>
+                    <h2 class="minigame-title">PREPÁRATE</h2>
                     <div id="countdown-display" class="countdown-display">5</div>
-                    <p class="minigame-description">Los sonidos se reproducirán en...</p>
+                    <p class="minigame-description">Los movimientos ocurrirán en...</p>
                 </div>
 
                 <!-- Fase 3: Botón INVESTIGAR -->
                 <div id="investigate-phase" class="minigame-phase" style="display: none;">
                     <h2 class="minigame-title">🔍 INVESTIGACIÓN</h2>
-                    <p class="minigame-description">¿Qué sonido escuchaste de cada jugador?</p>
+                    <p class="minigame-description">¿Qué movimiento escuchaste de cada jugador?</p>
                     <button id="investigate-btn" class="minigame-btn investigate-btn" onclick="showSoundSel
ectionInterface()">

                         INVESTIGAR
                     </button>
@@ -2482,14 +2482,14 @@
             updateRoomDisplay(gameData.playerDistribution);
             
             // Mostrar botón "ANOTAR PREGUNTA" solo cuando no esté en modo de movimiento
-            const addQuestionBtn = document.querySelector('.add-question-btn');
+            /*const addQuestionBtn = document.querySelector('.add-question-btn');
             if (addQuestionBtn) {
                 if (gameData.state !== "MOVING") {
                     addQuestionBtn.style.display = 'inline';
                 } else {
                     addQuestionBtn.style.display = 'none';
                 }
-            }
+            }*/
             
             // Actualizar estado de jugadores (incluyendo contadores de preguntas)
             showDeadsInfo();
@@ -2887,10 +2887,10 @@
             disableRoomSelection();
             
             // Mostrar botón "ANOTAR PREGUNTA" cuando se deshabilita el modo de movimiento
-            const addQuestionBtn = document.querySelector('.add-question-btn');
+           /* const addQuestionBtn = document.querySelector('.add-question-btn');
             if (addQuestionBtn) {
                 addQuestionBtn.style.display = 'inline';
-            }
+            }*/
             
             // El estado de jugadores se mantiene visible siempre
         }
@@ -3773,7 +3773,8 @@
                             movementSounds: null,
                             soundSelections: null,
                             investigationCompleted: null,
-                            lastUpdated: serverTimestamp()
+                            lastUpdated: serverTimestamp(),
+                            playerVisibility: {}
                         });
                         
                         console.log('🎵 Estado del minijuego reseteado');
@@ -3795,7 +3796,7 @@
                 alert('Error al reiniciar el juego. Por favor, intenta de nuevo.');
                 
                 // Restaurar el botón en caso de error
-                restartBtn.textContent = 'REINICIAR JUEGO';
+                restartBtn.textContent = 'REINICIAR';
                 restartBtn.disabled = false;
                 restartBtn.style.opacity = '1';
                 restartBtn.style.cursor = 'pointer';
```

---

Ahora voy a revisar el commit anterior para ver los cambios más significativos:


---

```bash
git show 55e8d94 --name-only
```

```

commit 55e8d944f1f188909608357d6aa8f819b0683e80
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 16:21:52 2025 +0200

    primero moverse, luego el juego

".specstory/history/2025-08-23_11-25Z-desarrollo-de-nueva-mec\303\241nica-de-juego.md"
.specstory/history/2025-08-23_13-28Z-cortar-audio-a-1-5-segundos.md
web/firebase-modular.js
web/index.html
web/sounds/sound-2.mp3
web/sounds/sound-3.mp3
```

---

Ahora voy a revisar el commit de test sound minigames para entender mejor la funcionalidad:


---

```bash
git show 4078cdf --name-only
```

```

commit 4078cdfa252ad19fcc6698a73516c6508449bdcc
Author: Jordi Marti <heedrox@gmail.com>
Date:   Sat Aug 23 14:30:50 2025 +0200

    test sound minigames

".specstory/history/2025-08-23_11-25Z-desarrollo-de-nueva-mec\303\241nica-de-juego.md"
docs/features/0002_PLAN.md
web/firebase-modular.js
web/index.html
web/sounds/sound-1.mp3
web/sounds/sound-2.mp3
web/sounds/sound-3.mp3
```

---

Ahora voy a revisar el archivo de planificación para entender mejor la nueva mecánica:


---

Read file: docs/features/0002_PLAN.md

---

Ahora voy a revisar el README actual para ver qué funcionalidades están documentadas y cuáles faltan:


---

<details>
            <summary>Grep search for "minijuego|sonido|audio|sound" • **0** files</summary>
        
No results found
</details>

---

<details>
            <summary>Grep search for "PEDOCIDIO" • **0** files</summary>
        
No results found
</details>

---

<details>
            <summary>Grep search for "CONTENED LA RESPIRACION" • **0** files</summary>
        
No results found
</details>

---

Basándome en mi análisis de los últimos 4 commits, he identificado que hay **funcionalidades importantes pendientes de documentar** en el README.md. Aquí está el resumen de lo que se ha implementado y lo que falta documentar:

## 🆕 **Funcionalidades Implementadas en los Últimos 4 Commits:**

### 1. **Minijuego de Sonidos para Visibilidad** (Commits 4078cdf y 55e8d94)
- **Sistema completo de minijuego** que reemplaza la probabilidad fija del 60% por un sistema basado en habilidad
- **5 fases del minijuego**: MOVERSE → PREPÁRATE → INVESTIGACIÓN → SELECCIÓN DE SONIDOS → ESPERANDO
- **3 sonidos diferentes** asignados aleatoriamente a cada jugador
- **Cálculo de accuracy** basado en aciertos del minijuego
- **Integración con sistema de visibilidad** existente

### 2. **Cambios de Texto y UI** (Commit d3c9867)
- **Título del juego cambiado** a "PEDOCIDIO"
- **Subtítulo actualizado** a "Cuando los invitados huelen a podrido..."
- **Textos del minijuego** actualizados para mayor claridad
- **Botón de reinicio** simplificado a "REINICIAR"

### 3. **Sistema de Audio** (Commits 4078cdf y 55e8d94)
- **3 archivos de sonido** implementados: `sound-1.mp3`, `sound-2.mp3`, `sound-3.mp3`
- **Reproducción automática** de sonidos durante el minijuego
- **Botones de referencia** para escuchar sonidos antes de la selección

## 📝 **Pendiente por Actualizar en README.md:**

### **Sección de Características del Juego:**
- [ ] **Sistema de minijuego de sonidos** - Nueva mecánica que reemplaza la probabilidad fija del 60%
- [ ] **5 fases del minijuego** - MOVERSE, PREPÁRATE, INVESTIGACIÓN, SELECCIÓN, ESPERANDO
- [ ] **Cálculo de visibilidad basado en habilidad** - Sistema de accuracy personalizado por jugador
- [ ] **Sistema de audio integrado** - 3 sonidos diferentes para identificación de movimientos
- [ ] **Interfaz de selección de sonidos** - Sistema de investigación para cada jugador

### **Sección de Mecánicas de Juego:**
- [ ] **Minijuego de sonidos** - Activación automática después del movimiento
- [ ] **Sistema de accuracy** - Porcentaje de aciertos que determina la visibilidad
- [ ] **Fases del minijuego** - Flujo completo desde movimiento hasta investigación

### **Sección de Próximas Funcionalidades:**
- [x] **Sistema de minijuego de sonidos** - ✅ IMPLEMENTADO (mover a características implementadas)

### **Sección de Tecnologías:**
- [ ] **Sistema de audio** - Reproducción de sonidos MP3 en navegador
- [ ] **Minijuegos interactivos** - Sistema de fases y estados del juego

¿Te gustaría que actualice el README.md para incluir todas estas nuevas funcionalidades del minijuego de sonidos?

---

_**User**_

si

---

_**Assistant**_

Perfecto, voy a actualizar el README.md para incluir todas las nuevas funcionalidades del minijuego de sonidos que se han implementado en los últimos commits.


---

Error calling tool 'edit_file'.

---

_**User**_

También quiero que revises el campo "state", sé que puede estar en modo:
- TALKING: "el modo normal, donde los jugadores discuten".
- MOVING: cuando el jugador 1 pulsa "TERMINAR RONDA".
- MINIGAME_ACTIVE: cuando los jugadores han movido, y el jugador 1 pulsa "SIGUIENTE RONDA".
- Y vuelta a TALKING.

Actualiza README con esa info.

---

_**Assistant**_

Perfecto, voy a actualizar el README.md para incluir tanto las nuevas funcionalidades del minijuego de sonidos como la información sobre los estados del juego. Primero voy a revisar la estructura actual del README para hacer las actualizaciones de manera organizada.


---

<details>
            <summary>Grep search for "Sistema de rondas|Estados del juego|state" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/jordimarti/Development/who-lies/README.md` | L284 | `- **Sistema de rondas** con botón "TERMINAR RONDA"` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L302 | `- **Sistema de rondas completo** - Control de fases del juego con modo de movimiento` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L351 | `#### ❌ **Error: "FIRESTORE INTERNAL ASSERTION FAILED: Unexpected state"**` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L525 | `### 🎯 Sistema de Rondas y Movimiento` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L556 | `- **Transiciones suaves**: Animaciones fluidas entre diferentes estados del juego` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L601 | `- [x] **Sistema de rondas del juego** - Gestión completa de fases del juego con modo de movimiento` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L284 | `- **Sistema de rondas** con botón "TERMINAR RONDA"` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L302 | `- **Sistema de rondas completo** - Control de fases del juego con modo de movimiento` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L351 | `#### ❌ **Error: "FIRESTORE INTERNAL ASSERTION FAILED: Unexpected state"**` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L525 | `### 🎯 Sistema de Rondas y Movimiento` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L556 | `- **Transiciones suaves**: Animaciones fluidas entre diferentes estados del juego` |
| `file:///Users/jordimarti/Development/who-lies/README.md` | L601 | `- [x] **Sistema de rondas del juego** - Gestión completa de fases del juego con modo de movimiento` |

</details>

---

Ahora voy a buscar la sección específica del sistema de rondas para actualizarla:


---

Read file: README.md

---

Ahora voy a buscar la sección de características del juego para añadir las nuevas funcionalidades:


---

Read file: README.md

---

Ahora voy a actualizar el README.md. Primero actualizaré la sección de características del juego para incluir el minijuego de sonidos:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 7, lines removed: undefined

```diff
@@ -313,4 +313,11 @@
  - **Persistencia de datos** - Los contadores se mantienen al recargar la página y se almacenan en Firebase
  - **Reset automático** - Los contadores se reinician a cero al reiniciar el juego
+ - **🎵 Sistema de minijuego de sonidos** - Nueva mecánica que reemplaza la probabilidad fija del 60% por un sistema basado en habilidad
+ - **🎯 5 fases del minijuego** - MOVERSE → PREPÁRATE → INVESTIGACIÓN → SELECCIÓN DE SONIDOS → ESPERANDO
+ - **🎵 Cálculo de visibilidad basado en habilidad** - Sistema de accuracy personalizado por jugador que determina la visibilidad
+ - **🔊 Sistema de audio integrado** - 3 sonidos diferentes (sound-1.mp3, sound-2.mp3, sound-3.mp3) para identificación de movimientos
+ - **🎮 Interfaz de selección de sonidos** - Sistema de investigación donde cada jugador debe identificar qué sonido escuchó de cada otro jugador
+ - **📊 Sistema de accuracy en tiempo real** - Porcentaje de aciertos que se calcula automáticamente y se almacena en Firebase
+ - **🔄 Flujo de minijuego integrado** - Activación automática después del movimiento, sincronización entre todos los jugadores
  
  ## 🔧 Configuración del entorno
```

</details>

---

Ahora voy a actualizar la sección del sistema de rondas para incluir la información sobre los estados del juego:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 5, lines removed: undefined

```diff
@@ -532,4 +532,9 @@
  ### 🎯 Sistema de Rondas y Movimiento
  - **Control de rondas**: Solo el jugador 1 puede activar el modo de movimiento
+ - **Estados del juego**: Sistema de 4 estados que controlan el flujo del juego:
+   - **TALKING**: Modo normal donde los jugadores discuten y comparten información
+   - **MOVING**: Cuando el jugador 1 pulsa "TERMINAR RONDA", los jugadores seleccionan su próxima ubicación
+   - **MINIGAME_ACTIVE**: Cuando todos han movido y el jugador 1 pulsa "SIGUIENTE RONDA", se activa el minijuego de sonidos
+   - **TALKING**: Vuelta al modo normal después de completar el minijuego
  - **Modo de movimiento**: Interfaz especial que permite a los jugadores seleccionar su próxima ubicación
  - **Restricciones de movimiento**: Los jugadores normales pueden moverse a habitaciones contiguas o quedarse en la misma ubicación
```

</details>

---

Ahora voy a añadir una nueva sección específica para el minijuego de sonidos después de la sección de rondas:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 15, lines removed: undefined

```diff
@@ -547,4 +547,19 @@
  - **Finalización automática**: La ronda se finaliza automáticamente cuando todos han movido
  - **Recálculo de visibilidad**: Nueva distribución y visibilidad se calculan automáticamente al finalizar
+ 
+ ### 🎵 Sistema de Minijuego de Sonidos
+ - **Activación automática**: Se activa cuando el jugador 1 pulsa "SIGUIENTE RONDA" después del movimiento
+ - **5 fases del minijuego**:
+   1. **MOVERSE**: Pantalla con botón "MOVERSE" y texto "CONTENED LA RESPIRACION - Pulsad 'MOVER' a la vez"
+   2. **PREPÁRATE**: Contador regresivo 5-4-3-2-1-0 con texto "Los movimientos ocurrirán en..."
+   3. **INVESTIGACIÓN**: Botón "INVESTIGAR" con texto "¿Qué movimiento escuchaste de cada jugador?"
+   4. **SELECCIÓN DE SONIDOS**: Interfaz para seleccionar qué sonido escuchó cada jugador (SONIDO 1, 2 o 3)
+   5. **ESPERANDO**: Pantalla de espera hasta que todos completen la investigación
+ - **Sistema de sonidos**: 3 sonidos diferentes asignados aleatoriamente a cada jugador
+ - **Botones de referencia**: Permiten escuchar cada sonido antes de hacer la selección
+ - **Cálculo de accuracy**: Porcentaje de aciertos que reemplaza la probabilidad fija del 60%
+ - **Integración con visibilidad**: La visibilidad se calcula basándose en el accuracy personalizado de cada jugador
+ - **Sincronización**: Todos los jugadores deben completar la investigación antes de continuar
+ - **Persistencia**: Los datos de accuracy se almacenan en Firebase para referencia futura
  
  ### 🔪 Mecánica de Asesinato Optimizada
```

</details>

---

Ahora voy a actualizar la sección de tecnologías para incluir el sistema de audio:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 2, lines removed: undefined

```diff
@@ -254,4 +254,6 @@
  - **Autenticación**: Sistema de login anónimo con gestión de sesiones
  - **Arquitectura Firebase**: Patrón modular con singleton, caché persistente y soporte multi-tab
+ - **Sistema de audio**: Reproducción de sonidos MP3 en navegador para minijuegos interactivos
+ - **Minijuegos interactivos**: Sistema de fases y estados del juego con sincronización en tiempo real
  
  ## 📁 Estructura del proyecto
```

</details>

---

Ahora voy a actualizar la sección de próximas funcionalidades para mover el minijuego de sonidos a las características implementadas:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -639,4 +639,5 @@
  - [x] **Arquitectura Firebase "a prueba de bombas"** - Implementación del patrón recomendado por GPT5 para evitar errores de reconexión
  - [x] **Sistema de anotación de preguntas** - Botón "ANOTAR PREGUNTA" para contabilizar preguntas de cada jugador con visualización de palos "I" debajo de avatares
+ - [x] **🎵 Sistema de minijuego de sonidos** - Nueva mecánica que reemplaza la probabilidad fija del 60% por un sistema basado en habilidad con 5 fases y cálculo de accuracy personalizado
  - [ ] **Base de datos de pistas** - Sistema de pistas dinámicas y aleatorias
  - [x] **Modo multijugador** - Sincronización en tiempo real entre jugadores
```

</details>

---

Finalmente, voy a actualizar la sección de características del juego para incluir el nuevo título del juego:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -5,5 +5,5 @@
  ## 🎯 ¿Qué es WHO LIES?
  
- **WHO LIES** es un juego de misterio y deducción donde los jugadores deben triangular información para descubrir quién es el asesino. El juego se desarrolla en un entorno de "murder mystery" similar a Cluedo, pero con un enfoque en la triangulación de pistas y la lógica deductiva.
+ **WHO LIES** (también conocido como **PEDOCIDIO**) es un juego de misterio y deducción donde los jugadores deben triangular información para descubrir quién es el asesino. El juego se desarrolla en un entorno de "murder mystery" similar a Cluedo, pero con un enfoque en la triangulación de pistas y la lógica deductiva.
  
  ### 🎮 Concepto del juego
```

</details>

---

Ahora voy a añadir información sobre el subtítulo actualizado:


---

<details><summary>Edit file: README.md</summary>

undefined

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -132,4 +132,5 @@
  - **Responsive**: Optimizado para pantallas verticales de dispositivos móviles
  - **Tipografía**: Fuente Georgia para dar un toque clásico y elegante
+ - **Subtítulo del juego**: "Cuando los invitados huelen a podrido..." - Referencia temática al misterio
  
  ### 🔧 Evolución técnica
```

</details>

---

Perfecto! He actualizado el README.md con toda la información sobre las nuevas funcionalidades implementadas en los últimos commits. Aquí está el resumen de las actualizaciones realizadas:

## ✅ **README.md Actualizado con las Nuevas Funcionalidades:**

### �� **Sistema de Minijuego de Sonidos**
- **5 fases del minijuego** documentadas: MOVERSE → PREPÁRATE → INVESTIGACIÓN → SELECCIÓN → ESPERANDO
- **Sistema de audio integrado** con 3 sonidos diferentes
- **Cálculo de accuracy** que reemplaza la probabilidad fija del 60%
- **Integración con visibilidad** basada en habilidad personalizada

### 🎯 **Estados del Juego Documentados**
- **TALKING**: Modo normal de discusión
- **MOVING**: Modo de movimiento de jugadores
- **MINIGAME_ACTIVE**: Activación del minijuego de sonidos
- **TALKING**: Vuelta al modo normal

### 🎮 **Nuevas Características del Juego**
- **Título actualizado**: "PEDOCIDIO" 
- **Subtítulo**: "Cuando los invitados huelen a podrido..."
- **Sistema de minijuegos interactivos** con sincronización en tiempo real
- **Sistema de audio** para navegadores

### 🔧 **Actualizaciones Técnicas**
- **Tecnologías añadidas**: Sistema de audio MP3 y minijuegos interactivos
- **Funcionalidades implementadas**: Minijuego de sonidos movido a características completadas
- **Estructura del juego**: Flujo completo de estados documentado

El README.md ahora refleja completamente el estado actual del proyecto, incluyendo todas las funcionalidades del minijuego de sonidos que se implementaron en los últimos commits, así como la información detallada sobre los estados del juego y el flujo de rondas.

---

